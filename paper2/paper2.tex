% gjilguid2e.tex
% V2.0 released 1998 December 18
% V2.1 released 2003 October 7 -- Gregor Hutton, updated the web address for the style files.

%\documentclass[extra,mreferee]{gji}
%\documentclass[extra, onecolumn, doublespacing]{gji}
%\documentclass[extra]{gji}
%\RequirePackage{lineno}
\documentclass[12pt,double]{article}


%\bibliographystyle{agufull08} % Uncomment when generating bibliography
%\usepackage{timet}
\usepackage[dvips]{graphicx}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{rotating}
\usepackage{natbib}
\usepackage{lineno}
%\usepackage{titlesec}
\linenumbers

\linespread{1.5}

\newcommand{\mitbf}[1]{  
  \hbox{\mathversion{bold}$#1$}}  
  \newcommand{\rmn}[1] {{\mathrm #1}}  
  \newcommand{\itl}[1] {{\mathit #1}}  
  \newcommand{\bld}[1] {{\mathbf #1}}  


%\titleformat{\section}
%{\bf}{\thesection}{1em}{\MakeUppercase{#1}}

%\date{Received 2012 Month Day; in original form 2012 Month Day}
%\pagerange{\pageref{firstpage}--\pageref{lastpage}}
%\volume{200}
%\pubyear{2012}

%\def\LaTeX{L\kern-.36em\raise.3ex\hbox{{\small A}}\kern-.15em
%    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}
%\def\LATeX{L\kern-.36em\raise.3ex\hbox{{\Large A}}\kern-.15em
%    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}
% Authors with AMS fonts and mssymb.tex can comment out the following
% line to get the correct symbol for Geophysical Journal International.
\let\leqslant=\leq

\newtheorem{theorem}{Theorem}[section]

\begin{document}

\begin{centering}
\LARGE{\textbf{Relocating a Cluster of Earthquakes Using a Single Seismic Station}} \\  
\end{centering}
\vspace{3em}
\begin{centering}
David J. Robinson, Malcolm Sambridge, Roel Snieder, Juerg Hauser \\
\end{centering}

\vspace{7em}
\begin{tabular}{lp{0.6\textwidth}}
 & \\
David Robinson: & Earth Monitoring and Hazard Group \\
 &  Geoscience Australia \\
 & GPO Box \emph{383} \\
 & Canberra ACT \emph{2601} Australia \\
 & E-mail: david.robinson@ga.gov.au\\
\end{tabular}

\clearpage
\label{firstpage}

%\maketitle

\vspace{2em}
\begin{centering}
\section*{Abstract}
\end{centering}
Coda-waves arise from scattering to form the later arriving
components of a seismogram. Coda-wave interferometry is an emerging
tool for constraining earthquake source properties from the
intereference pattern of coda-waves between nearby events. A new
earthquake location algorithm is derived which relies on coda-wave
based probabilistic estimates of earthquake separation. The
algorithm can be used with cod-waves alone or in tandem with arrival-time 
data. Synthetic examples in 2D and 3D and real earthquakes on
the Calaveras Fault, California are used to demonstrate the
potential of coda-waves for locating poorly recorded earthquakes. It
is demonstrated that coda-wave interferometry: (a) outperforms
traditional earthquake location techniques when the number of
stations is small; (b) is self-consistent across a broad range of
station situations; and (c) can be used with a single station to
locate earthquakes.


%\begin{keywords}
% Probability distributions; Earthquake source observations;
%Seismicity and tectonics; Wave scattering and diffraction
%\end{keywords}



\vspace{2em}
\begin{centering}
\section*{Introduction} 
\end{centering}

Accurate earthquake location is important for many applications. Locations
are required for:  magnitude
determination \citep{dr_Richter35a, dr_Gutenberg45a};
computing moment tensors \citep{dr_Sipkin02a};
seismological studies of the Earth's interior
\citep{dr_Spencer80a, dr_Kennett95a, dr_Curtis02a, dr_Kennett04a};
understanding strong motion and seismic attenuation
\citep{dr_Toro97a, dr_Campbell03a}
 and modeling earthquake hazard or risk
\citep{dr_Frankel00a, dr_Stirling02a, dr_Robinson06b}.
The accuracy required in earthquake location depends on the
application. For example, imaging the structure of a fracture system
from microseismicity requires greater location accuracy than determining
whether a $M_w=7.5$ earthquake occurs offshore for tsunami warning.
 This paper focuses on reducing location uncertainty for
a cluster of events when they are recorded by a small
number of stations.

Absolute location describes the location of an earthquake with
respect to a global reference such as latitude, longitude (or
easting/northing) and depth. Uncertainties associated with absolute
locations are influenced by source to station distances, the number
of stations and their geometry, signal-to-noise ratio, clarity of onsets
and accuracy of the velocity model used in computing arrival-times.
Uncertainties in absolute location are typically of the order of
several kilometers, primarily because they are susceptible to uncertainty in
the velocity structure along the entire path between the source and
receiver. For example, \citet{dr_Shearer99a} states that location
uncertainties in the ISC (International Sesimological
Centre) and PDE (National Earthquake
Information
Center)
catalogues are generally around 25\,km horizontally and at least
25\,km in depth (Here the depth uncertainties of 25\,km
assume the use of depth dependent phases such as $pP$. Without such
phases the uncertainty is higher). \citet{dr_Bondar04a} demonstrate
that absolute locations are accurate to within
5\,km with a 95\% confidence level when local networks meet the following 
criteria:
\begin{enumerate}
\item there are 10 or more stations, all within 250 km, 
\item an azimuthal gap of less than 110$^o$, 
\item a secondary azimuthal gap of less than 160$^o$, and 
\item at least one station within 30 km. 
\end{enumerate}
Such errors are too large for many
applications, particularly those focussed on imaging rupture
surfaces from aftershock sequences.

Relative earthquake location involves locating a group of
earthquakes with respect to one another and was first introduced by
\citet{dr_Douglas67a} who developed the technique commonly known as
joint hypocenter determination (\citet{dr_Douglas67a}
originally used the term joint epicentre determination. However, he
was solving for hypocentre). In principle, relative locations can be
computed by differencing absolute locations. However,
\citet{dr_Pavlis92a} shows that inadequate knowledge of velocity
structure leads to systematic biases when relative positions are
computed in this way. To reduce errors from unknown velocity
structure, relative location techniques typically compute locations directly
from arrival-time differences computed by time-lag cross correlation of
early-onset body waves 
\citep{dr_Ito85a, dr_Got94a, dr_Slunga95a, dr_Nadeau97a, dr_Waldhauser99a}. Doing
so removes errors associated with velocity variations outside
the local region, because such variations influence all waveforms in
a similar manner \citep{dr_Shearer99a}.

Reported location uncertainties from relative techniques are around
15 to 75\,m in local settings with good station coverage
\citep{dr_Ito85a, dr_Got94a, dr_Waldhauser99a,dr_Waldhauser08a}.
Here, `good coverage' implies multiple stations distributed across a
broad range of azimuthal directions. Relative location techniques
have been used to image active fault planes \citep{dr_Deichmann92a,
dr_Got94a, dr_Waldhauser99a, dr_Waldhauser02a, dr_Shearer05a}; study
rupture mechanics \citep{dr_Rubin99a, dr_Rubin02a}; interpret magma
movement in volcanoes \citep{dr_Fremont87a}; and monitor
pumping-induced seismicity \citep{dr_Lees98a, dr_Ake05a}.

In traditional approaches to absolute and relative location only
early onset body waves, typically $P$ and/or $S$ waves, are used. The
data utilised may be the direct arrival-times; arrival-time
difference computed between picked arrivals of two waveforms; or
arrival-time differences inferred from time-lagged cross correlation of
relatively small windows around the body wave arrivals.
 In all three cases, the majority of the
waveform is discarded. Furthermore, obtaining high accuracy with these techniques
requires multiple stations with good azimuthal coverage.
In this paper we demonstrate that it is possible to
significantly reduce location uncertainty when few stations are
available by using more of the waveform.

Coda refers to  later arriving waves in the seismogram that arise
from scattering  \citep{dr_Aki69a,dr_Snieder99a,dr_Snieder06a}. Coda
waves are ignored in most seismological applications due to the
complexity involved in constraining complex hetergeneous velocity models
in real settings. In this paper we
develop an approach for locating earthquakes using coda-waves.
\citet{dr_Snieder05a} demonstrate that the coda of two earthquakes
can be used to estimate the separation between them. Their
technique, known as coda wave interferometry (CWI), is based on the
interference pattern between the coda-waves. Unlike arrival-time
based location techniques, CWI
 does not require multiple stations or good azimuthal coverage.
In fact, it is possible to obtain estimates of separation using a single
station \citep{dr_Robinson07b}. This makes CWI particularly interesting
for regions where station density is low such as intraplate settings. In this
paper we demonstrate how CWI separation estimates can be used to constrain
location with data from a single station.
Our technique can be used on coda-waves alone or in combination with
arrival-times. We begin by introducing the theory of CWI based earthquake location. 
This is followed by a demonstration of capability using
synthetic examples and application to earthquakes
on the Calaveras fault, California using CWI alone
and CWI in combination with arrival-time constraints.

\vspace{2em}
\begin{centering}
\section*{Theory}
\end{centering}
\label{sec:theory}

\citet{dr_Snieder05a} introduce a CWI based estimator of source
separation $\delta_{CWI}$ between two earthquakes
\begin{linenomath*} \begin{equation}
\label{eq:Theory-dcwi_g_sigmat}
\delta_{CWI}^2 = g(\alpha,\beta)\sigma_\tau^2,
\end{equation} \end{linenomath*}
where $\sigma_\tau$ is the standard deviation of the arrival-time
perturbation between the coda-waves of two earthquakes, and $\alpha$
and $\beta$ are the near-source $P$ and $S$ wave velocities,
respectively. The function $g$ depends on the type of excitation
(explosion, point force, double couple) and on the direction of
source displacement relative to the point force or double couple.
For example, for two double couple sources displaced in the fault
plane,
\begin{linenomath*} \begin{equation}
\label{eq:LitReview-g-3d-dc}
g(\alpha,\beta) = 7
\frac{\left(\frac{2}{\alpha^6}+\frac{3}{\beta^6}\right)}{\left(\frac{6}{\alpha^8}+\frac{7}{\beta^8}\right)},
\end{equation} \end{linenomath*}
whereas, for two point sources in a 2D acoustic medium
\begin{linenomath*} \begin{equation}
\label{eq:LitReview-g-2d-ps} g(\alpha,\beta) = 2 \alpha^2
\end{equation} \end{linenomath*}
\citep{dr_Snieder05a}. \citet{dr_Snieder05a} also show that for two 
double couple sources that are not in the same fault plane
\begin{linenomath*} \begin{equation}
\label{eq:LitReview-fulDC-sep}
\sigma_\tau^2 = 
\frac{ \left(\frac{6}{\alpha^8}+\frac{7}{\beta^8} \right) \delta_{\| fault}^2 + 
2 \left(\frac{1}{\alpha^8}+\frac{2}{\beta^8} \right) \delta_{\perp fault}^2 }
{7 \left(\frac{2}{\alpha^8}+\frac{3}{\beta^8} \right)},
\end{equation} \end{linenomath*}
where $\delta_{\| fault}^2$ and $\delta_{\perp fault}^2$ are the separation parallel 
and perpendicular to the fault, respectively. In this paper we use 
equation \ref{eq:LitReview-g-2d-ps} for the 2D examples.
For the 3D examples we use equation
\ref{eq:LitReview-g-3d-dc} which assumes that the source mechanism
of both events are identical, an assumption likely to be true for
events in the same fault plane. \cite{dr_Robinson07c} explore the
impact of a change in mechanism.

The $\sigma_\tau$ in equation (\ref{eq:Theory-dcwi_g_sigmat}) is
related to the maximum of the cross correlation between the coda of
the two waveforms, $R_{max}$, and hence can be computed directly
from the recorded data. The original formulation by
\citet{dr_Snieder05a} used a second-order Taylor series expansion of
the waveform autocorrelation function to relate $\sigma_\tau$ and
$R_{max}$ by
\begin{linenomath*} \begin{equation}
\label{eq:Rmax-disp-orig} R_{max}^{(t,t_w)} = 1 - \frac{1}{2}
\overline{\omega^2} \sigma_\tau^2,
\end{equation} \end{linenomath*}
where $\overline{\omega^2}$ is the square of the dominant angular frequency
\begin{equation}
\label{eq:square-of-domangfreq}
\overline{\omega^2} =
\frac{\int_{t-t_w}^{t+t_w}\dot{u}_i^2(t')dt'}{\int_{t-t_w}^{t+t_w}u_i^2(t')dt'},
\end{equation}
and $\dot{u}_i$ represents the time derivative of $u_i$.
In this paper we use the autocorrelation approach of
\citet{dr_Robinson11a} to relate the parameters directly and we
apply a restricted time lag search when evaluating $R_{max}$. These
extensions to the original technique of \citet{dr_Snieder05a}
increase the range of applicability of CWI by 50\% (i.e. from 300 to
450\,m separation for 1 to 5\,Hz filtered coda-waves).

\citet{dr_Robinson11a} show that CWI leads to
probabilistic constraints on source separation and introduce a
Bayesian approach for describing the probability of true separation
given the CWI data. Their approach is summarised by
\begin{linenomath*} \begin{equation}
\label{eq:-bayesian-noisyform}
P(\widetilde{\delta}_t|\widetilde{\delta}_{CWIN}) \propto P(\widetilde{\delta}_{CWIN}|\widetilde{\delta}_t)
\times P(\widetilde{\delta}_t)
\end{equation} \end{linenomath*}
where  $P(\widetilde{\delta}_t|\widetilde{\delta}_{CWIN})$ is the
posterior function indicating the probability of true separation
$\widetilde{\delta}_t$ given the noisy CWI separation estimates
$\widetilde{\delta}_{CWIN}$;
$P(\widetilde{\delta}_{CWIN}|\widetilde{\delta}_t)$ is the
likelihood function (or forward model) giving the probability that
the separation estimates $\widetilde{\delta}_{CWIN}$ would be
observed if the true separation was $\widetilde{\delta}_t$; and
$P(\widetilde{\delta}_t)$ is the prior probability density function (PDF) accounting for all
a-priori information. The use of $N$ in $\delta_{CWIN}$ depicts CWI separations that include noise. 
The nomenclature is adopted here to remain consistent with \citet{dr_Robinson11a} who study 
synthetically generated noise-free $\delta_{CWI}$ and relate them to noisy estimates $\delta_{CWIN}$.
The tilde above the separation parameters in
equation (\ref{eq:-bayesian-noisyform}) indicates the use of a
wavelength normalised separation parameter
\begin{linenomath*} \begin{equation} 
\label{eq-normalisation-eqn}
\widetilde{\delta} = \frac{\delta}{\lambda_{d}},
\end{equation} \end{linenomath*}
which measures separation ($\delta$ = $\delta_{CWIN}$ or $\delta_t$)
with respect to dominant wavelength $\lambda_{d}$. In this paper we
consider a uniform prior over appropriate bounds to ensure that the
posterior function is dominated by the recorded data.
The procedure for computing the likelihood
$P(\widetilde{\delta}_{CWIN}|\widetilde{\delta}_t)$ is derived by
\citet{dr_Robinson11a} and summarised in Appendix (The Likelihood)
\ref{sec-Appendix-noisylikelihood}. With these two pieces in place
we can compute the posterior
$P(\widetilde{\delta}_t|\widetilde{\delta}_{CWIN})$ (or PDF) for the
separation between any pair of events directly from their coda
waves.

We seek a PDF which links
 individual pairwise posteriors $P(\widetilde{\delta}_t|\widetilde{\delta}_{CWIN})$
to describe the location of multiple events whose maximum corresponds to
 the most probable combination of locations.
More importantly, however, the PDF shall
quantify location uncertainty and provide information
on the degree to which individual events are constrained
 by the data. For convenience, we begin with three earthquakes having locations
$\mathbf{e}_1$, $\mathbf{e}_2$ and $\mathbf{e}_3$. Using a Bayesian
formulation we write
\begin{linenomath*} \begin{equation}
\label{eq-Bayes-three-locations}
P(\mathbf{e}_1, \mathbf{e}_2, \mathbf{e}_3| \mathbf{d}) \propto P( \mathbf{d}|\mathbf{e}_1, \mathbf{e}_2, \mathbf{e}_3)
\times P(\mathbf{e}_1, \mathbf{e}_2, \mathbf{e}_3),
\end{equation} \end{linenomath*}
where $P(\mathbf{e}_1, \mathbf{e}_2, \mathbf{e}_3 | \mathbf{d})$,
$P(\mathbf{d}|\mathbf{e}_1, \mathbf{e}_2, \mathbf{e}_3)$ and
$P(\mathbf{e}_1, \mathbf{e}_2, \mathbf{e}_3)$ are the posterior,
likelihood and prior functions, respectively. In equation
(\ref{eq-Bayes-three-locations}) $\mathbf{d}$ represents
observations that constrain the locations. They can be any
combination of arrival-times, geodetic information  or CWI
separations. For example, if coda-waves are used we have
$P(\mathbf{e}_1, \mathbf{e}_2, \mathbf{e}_3 |
\widetilde{\mitbf{\delta}}_{CWIN})$ and
$P(\widetilde{\mitbf{\delta}}_{CWIN}|\mathbf{e}_1, \mathbf{e}_2,
\mathbf{e}_3)$, where $\widetilde{\mitbf{\delta}}_{CWIN}$ are the
wavelength normalised separation estimates. Alternatively, if we use
CWI and arrival-time data we may write $P(\mathbf{e}_1, \mathbf{e}_2,
\mathbf{e}_3 | \widetilde{\mitbf{\delta}}_{CWIN},
\mathbf{\Delta}_{TT})$ and
$P(\widetilde{\mitbf{\delta}}_{CWIN},\mathbf{\Delta}_{TT}|\mathbf{e}_1,
\mathbf{e}_2, \mathbf{e}_3)$ where $\mathbf{\Delta}_{TT}$ represents
the arrival-time differences. In the following derivation and in 
the Synthetic Experiements and Relocating Earthquakes on the Calaveras Fault section we focus
on the constraints imposed by coda-waves, whereas in 
Combining Arrival-Time and CWI Constraints we demonstrate how CWI and arrival-time data can be combined.

For three earthquakes we have likelihoods;
$P(\widetilde{\delta}_{CWIN,12}|\mathbf{e}_1, \mathbf{e}_2)$,
$P(\widetilde{\delta}_{CWIN,13}|\mathbf{e}_1, \mathbf{e}_3)$
and
$P(\widetilde{\delta}_{CWIN,23}|\mathbf{e}_2, \mathbf{e}_3)$.
In writing
these likelihoods we have replaced the conditional term on separation
$\widetilde{\delta}_t$ with the locations (e.g. $\mathbf{e}_1$ and $\mathbf{e}_2$).
This can be done because
knowledge of location translates to separation. Note, however, that the reverse is
not true. That is, knowledge of separation between a single event pair
does not uniquely translate to location but rather places a non-unique constraint on
location. In other words, knowing $|e1-e2|$ and $|e2-e3|$ does not mean that $|e1-e3|$ is 
uniquely defined. Consequently, the likelihoods are weekly dependent, in that some 
likelihood-pairs share common events, an occurrence that becomes relatively less frequent 
as the number of events being located increases. 
For the purpose of this work we ignore this week dependance 
and assume independence
\begin{linenomath*} \begin{equation}
\begin{array}{l}
\label{eq:-joint-likelihood4three}
P(\widetilde{\mathbf{\delta}}_{CWIN} | \mathbf{e}_1, \mathbf{e}_2, \mathbf{e}_3) \approx
P(\widetilde{\delta}_{CWIN,12} | \mathbf{e}_1, \mathbf{e}_2) \\
\hspace{2em} \times P(\widetilde{\delta}_{CWIN,13} | \mathbf{e}_1, \mathbf{e}_3)
\times  P(\widetilde{\delta}_{CWIN,23} | \mathbf{e}_2, \mathbf{e}_3).
\end{array}
\end{equation} \end{linenomath*}
Similarly, the earthquake locations are independent and the
joint prior becomes
\begin{linenomath*} \begin{equation}
\label{eq:-joint-prior4three} P(\mathbf{e}_1, \mathbf{e}_2,
\mathbf{e}_3) = P(\mathbf{e}_1) \times P(\mathbf{e}_2) \times
P(\mathbf{e}_3).
\end{equation} \end{linenomath*}
Combining equations (\ref{eq:-joint-likelihood4three}) and
(\ref{eq:-joint-prior4three}) gives the joint posterior function
\begin{linenomath*} \begin{equation}
\label{eq-3eqposterior}
\begin{array}{l}
P(\mathbf{e}_1, \mathbf{e}_2, \mathbf{e}_3 | \widetilde{\mitbf{\delta}}_{CWIN}) = c \displaystyle \prod_{i=1}^3 P(\mathbf{e}_i) \\
\hspace{4em}  \times \displaystyle \prod_{i=1}^2 \prod_{j=i+1}^3
P(\widetilde{\delta}_{CWIN,ij}|\mathbf{e}_i,\mathbf{e}_j)
\end{array}
\end{equation} \end{linenomath*}
for three events.

A detailed understanding of the location of a single event (e.g. $\mathbf{e}_2$) is obtained by computing the
marginal
\begin{linenomath*} \begin{equation}
\label{eq:-E2-marginal}
P(\mathbf{e}_2|\mathbf{\delta}_{CWIN}) = \int \int P(\mathbf{e}_1, \mathbf{e}_2,
 \mathbf{e}_3 | \widetilde{\mathbf{\delta}}_{CWIN}) d\mathbf{e}_1
 d\mathbf{e}_3,
\end{equation} \end{linenomath*}
where the intergral is taken over all plausible locations for
$\mathbf{e}_1$ and $\mathbf{e}_3$. Alternatively, we can compute the
marginal for a single event coordinate by integrating the posterior
over all events and remaining coordinates for the chosen earthquake.
Evaluation of the normalizing constant $c$ in equation (\ref{eq-3eqposterior}) involves
finding the integral of the posterior function
over all plausible locations. In many applications the constant
of proportionality $c$ can be ignored. For example, it is not
required when seeking the combination of locations which maximise
 the posterior function, nor in Bayesian sampling algorithms such as Markov-chain Monte-Carlo
techniques which only require evaluation of a function proportional to the PDF.

Extending to $n$ events we get the posterior function
\begin{linenomath*} \begin{equation}
\begin{array}{l}
\label{posterior-n-events}
P(\mathbf{e}_1,...,\mathbf{e}_n | \widetilde{\mathbf{\delta}}_{CWIN}) = c \displaystyle \prod_{i=1}^n P(\mathbf{e}_i) \\
\hspace{4em} \displaystyle  \times \prod_{i=1}^{n-1} \prod_{j=i+1}^n P(\widetilde{\delta}_{CWIN,ij}|\mathbf{e}_i,\mathbf{e}_j).
\end{array}
\end{equation} \end{linenomath*}
When evaluating equation (\ref{posterior-n-events})
over a range of locations it is necessary to compute and multiply
many numbers close to zero. This is because the PDFs tend to zero as
the locations get less likely (i.e. near the boundaries of the
plausible region). Such calculations are prone to truncation errors
and so we work with the negative logarithm
\begin{linenomath*} \begin{equation}
\label{eq:-negative-log-part1}
L(\mathbf{e}_1, \mathbf{e}_2, ..., \mathbf{e}_n) = -ln\left[ P(\mathbf{e}_1,...,\mathbf{e}_n | \widetilde{\mathbf{\delta}}_{CWIN} )  \right]
\end{equation} \end{linenomath*}
or
\begin{linenomath*} \begin{equation}
\begin{array}{l}
\label{eq:-negative-log}
L(\mathbf{e}_1, \mathbf{e}_2, ..., \mathbf{e}_n) =
-ln\left[ c \right] - \displaystyle \sum_{i=1}^n ln\left[P(\mathbf{e}_i)\right] \\
\hspace{3em} - \displaystyle \sum_{i=1}^{n-1} \sum_{j=i+1}^n ln\left[P(\widetilde{\delta}_{CWIN,ij}|\mathbf{e}_i,\mathbf{e}_j)\right].
\end{array}
\end{equation} \end{linenomath*}
The logarithm improves numerical stability by replacing products
with summations. The negative facilitates the use of optimisation
algorithms that are designed to minimise an objective function.

The event locations $\mathbf{e}_1, \mathbf{e}_2, ..., \mathbf{e}_n$
are defined by coordinates $\hat{x}$, $\hat{y}$ and $\hat{z}$ where
the hat indicates use of a local coordinate system. We choose a
local coordinate system which removes ambiguity associated with
transformations of the coordinate system. It is necessary to do this
because the distances between events are invariant for rotations,
reflections and translations of the seismicity pattern and hence
cannot be resolved from CWI alone. In defining this coordinate
system we fix the first event at the origin
\begin{linenomath*} \begin{equation} 
\label{eq:coord-const1}
\mathbf{e}_1 = (0,0,0),
\end{equation} \end{linenomath*}
the second event on the positive $\hat{x}$-axis
\begin{linenomath*} \begin{equation} 
\label{eq:coord-const2}
\mathbf{e}_2 = (\hat{x}_2, 0, 0), \hat{x}_2>0
\end{equation} \end{linenomath*}
the third on the $\hat{x}-\hat{y}$ plane
\begin{linenomath*} \begin{equation}
\label{eq:coord-const3}
\mathbf{e}_3 = (\hat{x}_3,\hat{y}_3,0), \hat{y}_3>0
\end{equation} \end{linenomath*}
and the fourth to
\begin{linenomath*} \begin{equation} 
\label{eq:coord-const4}
\mathbf{e}_4 = (\hat{x}_4,\hat{y}_4,\hat{z}_4), \hat{z}_4>0.
\end{equation} \end{linenomath*}
This coordinate system reduces translational (equation \ref{eq:coord-const1})
and rotational (equations \ref{eq:coord-const2} to \ref{eq:coord-const4}) non-uniqueness
without loss of generality. It is necessary to work with a local coordinate
system when using coda-waves alone because the CWI technique constrains only event separation
between earthquakes. The inclusion of arrival-times in the Combining Arrival-Time 
and CWI Constraints section 
allows us to move to a global reference system.

In summary, the posterior $P(\mathbf{e}_1,...,\mathbf{e}_n |
\widetilde{\mathbf{\delta}}_{CWIN})$ and its negative logarithm $L$
describe the joint probability of multiple event locations given the
observed coda-waves. The most likely set of locations is given by
the minimum of $L$.   In this paper we use the Polak-Ribiere
technique \citep{dr_Press87a}, a conjugate gradient method, to
minimize $L$. It uses the derivatives of $L$, derived in Appendix (Derivatives)
\ref{sec-Appendix-derivatives_ofL}, to guide the
optimization procedure. Note that when optimizing
equation \ref{eq:-negative-log} the values of $ln \left[ c \right]$
and $ln \left[ P(e_i) \right]$ can be ignored because they are
constant ($ln \left[ P(e_i) \right]$ is constant because we
consider a uniform prior).

\vspace{2em}
\begin{centering}
\section*{Synthetic experiments}
\end{centering}

\label{sec:benchmarking}

We use synthetic examples in 2D and 3D with 50 earthquakes to test
the performance of the optimization routine. In these examples the
synthetic earthquakes are located randomly and CWI data generated
according to the event separation. It is not necessary to generate
synthetic waveforms and compute CWI estimates directly because we
are testing the performance of the optimization routine only. The
ability of CWI to estimate event separation has been demonstrated
already \citep{dr_Snieder05a, dr_Robinson07b, dr_Robinson11a}. We
undertake a complete coda wave location experiment, including the
calculation of CWI separation estimates, for recorded earthquakes in 
Relocating Earthquakes on the Calaveras 
Fault and in Combining Arrival-Time and CWI Constraints.

\vspace{1em}
\subsection*{Examples 1 and 2 - 2D synthetic experiments}

We design a 2D synthetic acoustic experiment (example 1) to test the 
performance of our CWI based relative location algorithm by randomly
selecting $\hat{x}$- and $\hat{y}$-coordinates such that $-50 \leq
\hat{x}, \hat{y} \leq 50$\,m. These are indicated with triangles in
Figure \ref{fig-2D50eq-relocation_eg1}.
 We assume a local velocity of $\alpha=3300\,$ms$^{-1}$ between all
event pairs and a dominant frequency of 2.5$\,$Hz to represent
waveform data filtered between 1 and 5$\,$Hz. The purpose of these
examples is to synthetically test the location algorithm. 
Hence, we do not need to synthetically generate waveforms and compute
CWI separation estimates, Rather, we begin by synthetically generating 
the CWI separation estimates directly. \citet{dr_Robinson11a} showed that
the CWI data are
defined by the dominant wavelength normalized positive bounded
Gaussian PDF with statistics $\bar{\mu}_N$ and $\bar{\sigma}_N$. 
A hypothetical CWI mean is created by
setting
\begin{linenomath*} \begin{equation} 
\label{eq:hypothetical-CWI-mean-optichapt}
\bar{\mu}_N = \mu_1 \left( \widetilde{\delta}_t \right)
\end{equation} \end{linenomath*}
using equation (\ref{eq:mu1}). This assumption ensures that the
sample mean of hypothetical separation estimates is consistent with
known CWI biases \citep{dr_Robinson11a}. In example 1 we use
$\bar{\sigma}_N=0.02$ between all event pairs. Application of our
optimization procedure on the hypothetical CWI data yields the
circles in Figure \ref{fig-2D50eq-relocation_eg1}. The optimization
does not lead to the exact solution due to the addition of noise
($\bar{\sigma}_N=0.02$) on the hypothetical CWI data. The average
coordinate error is 2.0\,m  (average location error $\approx$4\,m) 
which is small compared to the noise of
$\bar{\sigma}_N=0.02$ which for $v_s=3300$\,ms$^{-1}$ and
$f_{dom}=2.5$\,Hz corresponds to roughly 25\,m.

\citet{dr_Robinson11a} demonstrates that the noise on CWI estimates
is often larger than 0.02 and that it increases with event
separation. Consequently, example 1 is simplistic because we fix
$\bar{\sigma}_N=0.02$ for all pairs. In example 2 we increase the
uncertainty and introduce a distance dependance into the
hypothetical $\bar{\sigma}_N$ by defining
$\bar{\sigma}_N=\epsilon(\delta_t)$, where
$\epsilon(\delta_t)$ is the half-width of the errorbars for a
synthetic acoustic experiment with filtering between 1 and 5\,Hz
\citep[see Fig. 4(b) of ][]{dr_Robinson11a}. Repeating the
optimization leads to the circles in Figure
\ref{fig-2D50eq-relocation_eg3} which have an average coordinate
error of 2.8\,m (average location error $\approx$9\,m).

Conjugate gradient based optimization techniques are susceptible to
the presence of local minima. This is because they use the slope of
the target function to explore the solution space. We explore the
impact of local minima for our CWI location problem by beginning the
optimization from 25 randomly chosen starting positions. We observe
negligble difference in the solutions indicating that neither example 
is susceptible to local minima.

Three observations can be drawn from the error structure in Figures
\ref{fig-2D50eq-relocation_eg1} and \ref{fig-2D50eq-relocation_eg3}.
Firstly, the location errors depicted by gray bars increase between
examples 1 and 2 with the introduction of larger noise. Secondly,
the errors are larger for events at greater distances from the
center. This is because events near the center of the cluster are
constrained by links from all angles, whereas those on the outside
are moderated by links from a limited number of directions. This
observation is analogous to problems associated with poor azimuthal
coverage in triangulation such as individual earthquake
location from limited arrival-time data, or GPS positioning with few
satellites. Our third observation is that the location errors form a
pattern of circular rotation, despite our attempt to correct for
 rotational non-uniqueness with the local coordinate system.

The local coordinate system works by constraining the location of
the first three earthquakes. Earthquake 1 is fixed at the origin,
earthquake 2 on the positive $\hat{x}$-axis and earthquake 3 has
$\hat{y}>0$. As the number of events increase the strength of these
constraints on later events weakens allowing small rotations of
events with respect to each other. That is, even though the
rotational freedom of the cluster is in principle removed by the
constraints imposed on the events (see equations
(\ref{eq:coord-const1}) to (\ref{eq:coord-const3} - equation
\ref{eq:coord-const4} is needed in 3D only) we observe that in
practice the presence of noise allows the rotational non-uniqueness
to reappear. This is because errors align themselves in directions
least constrained by data. For the CWI technique this ammounts to rotations in 2D.
The same phenomenon is observed in linear inversion where noise
creates large spurious model changes in directions of the
eigenvectors with the smallest singular values \citep{dr_Aster05a}.
 Fortunately, however, combining coda-waves with
measurements of arrival-times alleviates this problem and facilitates
the removal of a local coordinate system altogether (see Combining Arrival-Time and 
CWI Constraints). On balance, however, we gain
confidence in the optimization procedure due to its stability for
different starting locations and because of the small average
coordinate errors of 2.0\,m and 2.8\,m for examples 1 and 2,
respectively.

\subsection*{Example 3 - The impact of incomplete event pairs in 2D}

Synthetic examples 1 and 2 use 100\% direct linkage between event
pairs. That is, there is a constraint between each earthquake and
all other events. In reality, we might expect that the separation
between some pairs will not be constrained by CWI data due to poor
signal to noise ratio in the coda for common stations. Obviously,
the fewer stations that record an event the more likely it is that
links between it and other events will be broken. In such cases the
probabilistic distance constraint between a pair of events may only
exist indirectly through multiple pairs. In this section we consider
the impact of reduced linkage between event pairs. In example 3, we
repeat example 2 using 90\%, 80\%, ..., 10\% of the links. 
That is, we randomly select 10\% of the event pairs and remove the 
separation estimates between those pairs to create a data set with 90\% 
linkage. Then, we randomly remove 20\% of the links and so on. 
This experiment is designed to mimic a realistic recording situation 
where CWI estimates are not available for all event pairs due to station 
problems, poor signal-to-noise ratio or any number of other reasons.
As with the above examples, we undertake the optimization with 25 randomly
chosen starting locations.


Figure \ref{fig:optimisationresults-2Dsynth} illustrates
the maximum $\Delta_{max}$ (top) and mean $\Delta_\mu$ (middle) of
the coordinate error as a function of percentage of earthquake pairs
that are directly linked by a separation estimate. We show the
statistics for the `best' optimization solution (thick) and for the
solution space when all 25 optimizations are considered (thin). In
the former case the best solution is determined by the set of event
locations which lead to the smallest value of $L$. The error in the
best solution is consistent when 30\% or more of the branches are
used. The errors increase when only 10\% or 20\% of the constraints
are included. Interestingly, this breakdown around 20\% to 30\%
coincides with the point where the average number of branches
required to link an event pair reaches 2 (see
Fig.\ref{fig:optimisationresults-2Dsynth} (bottom)). Since the
average number of branches can be computed in advance it can be used
as an indication of inversion stability prior to optimization. A
higher breakdown is observed when all 25 solutions are considered
collectively. For example, the maximum coordinate error
$\Delta_{max}$ exceeds that for the best solution for linkage
$\leq$60\% confirming that the optimization is susceptible to local
minima and that a range of starting points should be considered.
Some optimizations fail to converge after 1200 iterations when the
linkage is 60\% or lower. All optimizations fail when the linkage is
20\% or lower. 

The derivatives used in the conjugate gradient method depend on
events connected by CWI measurements. Consequently, earthquakes that
are only connected via other events do not `communicate' with each
other directly. To some extent, this should be adressed during the
iterative process where location information can spread to events
which have no direct links. However, the lack of direct connection
through the gradient could prevent convergence in extreme cases, or
more likely slow the procedure down. This could explain why some
examples do not converge after 1200 iterations.
\citet{dr_VanDecar94a} show that derivative based regularization acts slowly
through iterative least-squares, because
 every cell in one iteration communicates only with its neighbours, and they demonstrate that this can be
fixed with preconditioning in some cases. Their findings suggest
that it may be possible to improve the convergence (stability and/or
speed) of the CWI optimization by preconditioning.

\subsection*{Example 4 - The impact of incomplete event pairs in 3D}

In Example 4 we expand the optimization routine to 3D by randomly
picking a set of event locations for 50 earthquakes with
$-50$\,m$\leq \hat{x},\hat{y},\hat{z} \leq 50$\,m. As in the 2D case
we assume a local velocity of $v=3300\,$ms$^{-1}$ between all event
pairs and a dominant frequency of 2.5$\,$Hz to represent
 waveform data filtered between 1 and 5$\,$Hz.
The hypothetical CWI mean is created using equation
(\ref{eq:hypothetical-CWI-mean-optichapt}) which ensures consistency
between the sample mean of hypothetical separation estimates and CWI
biases. We use a standard deviation for the noisy CWI estimates of
$\bar{\sigma}_N = \epsilon(\delta_t)$ (where $\epsilon(\delta_t)$ is the same 
as that used in Examples 2 and 3) and perform the optimization
using 10\%, 20\%, ..., 100\% of the direct links. In each case we
repeat the optimization 25 times using randomly chosen starting
locations. The results are summarised in Figure
\ref{fig:optimisationresults-3Dsynth}.


When 70\% of the direct constraints are considered all optimization
results (thin) are consistent with the best solution obtained from
all 25 starting locations (thick). The
best solution constrains the event locations down to 30\% of the
direct links. This is depicted in Figure
\ref{fig:optimisationresults-3Dsynth} by the absence of the thin and
thick lines below 60\% and 30\% linkage, respectively.
The accurate convergence of the best
solution for cases with 30\% linkage or higher is encouraging for
the potential of coda wave optimization to constrain earthquake
location.

\subsection*{Summary of synthetic experiments}

In summary, the synthetic examples demonstrate the ability of coda
wave data to constrain relative event location using optimization.
The optimization error is rotational in nature and 
influenced by the noise on CWI estimates
with greater $\bar{\sigma}_N$ leading to larger errors in the
solutions. In 3D, when 70\% or more of the direct branches are used the
optimizer is stable with no observable difference in the solution
for 25 randomly chosen starting locations. As the direct linkage
reduces to 50\% the optimization becomes less stable and the best
solution from 25 random starting locations is required to find the
optimal solution. All optimisations fail to converge as the number
of links decrease below 30\%.

\vspace{2em}
\begin{centering}
\section*{Relocating Earthquakes on the Calaveras Fault}
\end{centering}
\label{sec:CalaverasLoc-CWIonly}

In this section we relocate 68 earthquakes from the Calaveras Fault,
California. The 68 earthquakes are selected from the 308 earthquake
Calaveras example released with the open source Double Difference
algorithm or hypoDD \citep{dr_Waldhauser00a, dr_Waldhauser01a} [See
also Data and Resources]. These events are chosen for four
reasons. Firstly, they are recorded by a large number of stations
(Fig. \ref{fig:-eqopti-California-Calaveras}) and therefore lend
themselves to accurate arrival-time location. This makes them ideal
for assessing the performance of a new location technique. Secondly,
they are distributed with separations from near zero to hundreds of
meters making them ideal for application of CWI. Thirdly, Calaveras
earthquakes have been well researched with several studies having
relocated events in the region \citep{dr_Waldhauser01a,
dr_Schaff02a, dr_Waldhauser08a}. Finally, the hypoDD locations for
these 68 earthquakes align in a streak increasing the likelihood
that they have near identical source mechanisms, a necessary
assumption for the application of equation
\ref{eq:LitReview-g-3d-dc}. The relocations in this paper are sorted
into four examples as summarised in Table \ref{tab:examples}. Waveforms, 
cross correlations and separation estimates for example Calaveras event pairs are 
illustrated by \citet{dr_Robinson11a} an are not repeated her for the sake of brevity.

\subsection*{Example 5 - comparison of CWI, catalogue and hypoDD locations}

Figure \ref{fig-69Calaverasevents_eg1} illustrates three sets of
locations for the Calaveras earthquakes. The first column shows the
original catalogue locations for all 308 earthquakes. That is, each event
is located individually using all available arrival-time data and
a regional velocity model. The 68 earthquakes of interest in this
study are differentiated in black. Catalogue locations suggest that
the 68 earthquakes of interest are spatially widely distributed on the scale of
 Figure \ref{fig-69Calaverasevents_eg1}.

To apply CWI we download available waveforms from the Northern
California Earthquake Data Center (See Data and Resources).
Unsuitable waveforms are removed using the conditions summarised in
Table \ref{tab:-conditions4unsuitablewaveform}. Remaining waveforms
are filtered between 1 and 5\,Hz and aligned  to $P$ arrivals at
0\,s. CWI estimates are obtained from 5\,s wide non-overlapping time
windows between $2.5 < t \leq 20$\,s and used to create
probabilistic constraints on event separation. We utilize the
local coordinate system introduced in the Theory Section and find the
optimum relative locations using Polak-Ribiere optimization.

In this, and the following Calaveras examples, we allow the earthquakes to 
move freely in all three directions during the inversion despite using the 
in-fault separation estimates given by equation \ref{eq:LitReview-g-3d-dc}.
We allow the events to move freely so that we can test the 
performance of our algorithm without assuming a-priori 
that the earthquakes are constrained on the same fault plane. 
We approximate the true event separation using the in-fault separation 
of equation \ref{eq:LitReview-g-3d-dc} so that we can focus on developing 
a working algorithm and demonstrate capability 
without dealing with the complexity of 
in-fault ($\delta_{\| fault}$) and out-of-fault 
($\delta_{\perp fault}^2$) displacement. Considering 
the more complicated formulation of equation \ref{eq:LitReview-fulDC-sep} is
left for future work. Another potential focus for future work 
involves refining our algorithm  
to simultaneously resolve event location and representative fault plane 
by restricting the events to align in a single (unknown a-priori) plane. 
That is, for cases where the earthquakes are 
believed a-priori to be in the same plan.

CWI locations for the 68 events are illustrated in column two of
Figure \ref{fig-69Calaverasevents_eg1}. Catalogue locations (gray)
are shown for the remaining 240 earthquakes and are included to ease
comparison. The third column of Figure
\ref{fig-69Calaverasevents_eg1} illustrates the locations given by
hypoDD with Singular Value Decomposition (SVD), absolute arrival
times and cross correlation computed arrival-time differences.

Absolute locations cannot be found by CWI alone. This is because of
the non-uniqueness associated with translation, rotation and
reflection. For the sake of comparison, we arbitrarily choose a
`master' event and translate our relative locations to align with
the hypoDD location for that event. This arbitrary translation
does not change the relative locations. We return to this issue of
relative versus absolute location in Example 7 by introducing a
combined arrival-time and coda-wave inversion.

The spatial distribution of the CWI locations is clearly tighter
than the catalogue locations of column 1. That is, CWI provides an
independent indication of clustering for the 68 events and to first
order, similar locations to those from hypoDD (column 3). There is a
small second order difference between the CWI and hypoDD based
locations. In particular, the lineation is less clear in the CWI
locations (column 2) than the hypoDD locations (column 3). Our
experience suggests that the CWI locations are less supportive of the presence of
streaks although a complete understanding of these differences is
left for future work. Our attention now is devoted towards
understanding how both techniques perform with fewer stations
(Example 6) and exploring how CWI and arrival-times can be combined
(Examples 7 and 8).


\subsection*{Example 6 - Dependance on the number of stations}


Accurate location of the Calaveras events is possible using arrival
phases because of the excellent recording situation in California
with many stations and strong azimuthal coverage (see Fig.
\ref{fig:-eqopti-California-Calaveras}). In contrast, a small number
of stations and poor azimuthal coverage are common limitations when
trying to locate intraplate clusters. For example, there are only
four network seismic stations in the South West Seismic Zone of
Western Australia, a region similar in size to that hosting 805
stations in Figure \ref{fig:-eqopti-California-Calaveras}.

We explore the impact of poorer recording situations in example 6 by
re-locating the 68 Calaveras events  using hypoDD and coda-waves
with a reduced number of stations. We begin with 10 stations and
repeat the process removing one at a time until a single station
remains. The 10 stations and there order of removal are shown in Figure
\ref{fig:-eqopti-Calaveras-substations}.

CWI locations are illustrated in Figure \ref{fig-CWIreducesstats}
for the inversions with seven, five, four, three, two and one
station. We observe a high level of consistency between these 6
inversions and the locations shown in Figure
\ref{fig-69Calaverasevents_eg1} (column 2) when all stations are
considered. That is, the coda-wave approach is self-consistent
regardless of the number of stations available, reinforcing our
claim that coda-waves can constrain location in what would
normally be regarded as a poor station network.


Figure \ref{fig-HYPODDreducesstats} illustrates the hypoDD inversion
results for seven, five and four stations. The arrival-time problem
is ill-posed for fewer than four stations so it is not possible to
apply hypoDD with SVD for three or fewer stations.  The hypoDD
locations are less self-consistent as the number of stations is
reduced. We observe a general increase in scatter and a higher
number of stray events outside the cluster when less stations are
used with hypoDD. Even with seven stations the linear geometry of
Figure \ref{fig-69Calaverasevents_eg1} (column 3) is less evident.


As the number of stations is reduced neither the CWI nor hypoDD
techniques are able to re-locate all events. To use the coda
waves we need at least one pairwise separation constraint to be
formed from the available stations. This means that for every event
there must be at least one station that records it, and at least one
other earthquake, sufficiently well to apply CWI. Fortunately, we can
make an assessment of this prior to starting the inversion. The top
panel of Figure \ref{fig-statremoval_summarystats} demonstrates that
when five or more stations are used, CWI can constrain the location
of all 68 earthquakes. When less than five stations are used the
coda-waves constrain a decreasing number of events until at one
station it is only possible to locate 55 of the 68 events. The
hypoDD algorithm also fails to locate all events as the number of
stations is reduced. In the case of hypoDD an event can be
identified as unconstrainable in one of two stages. Firstly, the
data are analyzed to ensure that there exist arrival-time
differences for each event and at least one other earthquake. This
is analogous to the situation for the coda-wave technique. The
hypoDD program also has a secondary identification phase in which
events that can not be located sufficiently well are rejected during the
inversion. This process is related to the iterative removal of
outliers described by \citet{dr_Waldhauser00a}. The top panel of
Figure \ref{fig-statremoval_summarystats} shows that the number of
events re-located by hypoDD fluctuates between 63 and 28 earthquakes
for ten to four stations and it demonstrates that the number of
events located by hypoDD is less than or equal to the number located
by CWI.


The remaining panels of Figure \ref{fig-statremoval_summarystats}
illustrate a statistical comparison of the CWI and hypoDD locations 
with a reduced number of stations to those using hypoDD with all available data. For
the CWI inversions the mean and maximum coordinate difference is
consistent regardless of the number of stations considered. In
contrast, the hypoDD mean and maximum coordinate error fluctuate
above those for CWI confirming that the hypoDD inversion is less
stable than CWI with fewer stations.

\vspace{2em}
\begin{centering}
\section*{Combining Arrival-Time and CWI Constraints}
\end{centering}
\label{sec:CalaverasLoc-CWIandTT}
In Examples 5 and 6 we compare the location of the Calaveras
earthquakes using coda-wave and arrival time based constraints
independently. Since the arrival time (direct or difference) and
coda-wave data
 come from different sections of the waveform they provide independent constraints on the locations.
 In this section we devise a location algorithm which incorporates
 both CWI and arrival-time data.

We do not propose a new technique for earthquake location using
arrival-time differences. Rather, we exploit the information created
by hypoDD with SVD to define a probability density (or posterior)
function
\begin{linenomath*} \begin{equation}
\label{eq-multi-var-Gauss-tt}
\begin{array}{l}
P(\mathbf{e}_p|\Delta_{TT})
\frac{1}{(2\pi)^{3/2}\sqrt{|\Sigma|}} \\
\hspace{5em} \times \exp
\left({-\frac{1}{2}\left([\mathbf{e}_p-\mu_{\mathbf{e}_p}]^T
\Sigma^{-1} [\mathbf{e}_p-\mu_{\mathbf{e}_p}]\right)} \right),
\end{array}
\end{equation} \end{linenomath*}
where
\begin{linenomath*} \begin{equation}
\mathbf{e}_p = (x_p,y_p,z_p)^T
\end{equation} \end{linenomath*}
is the location of event $p$,
\begin{linenomath*} \begin{equation}
\mu_{\mathbf{e}_p} = (\mu_{x_p}, \mu_{y_p},\mu_{z_p})^T
\end{equation} \end{linenomath*}
is the most likely location as determined using the arrival-time
data, and
\begin{linenomath*} \begin{equation}
\label{eq:Sigma-expression}
\Sigma = \left( \begin{array}{ccc} \sigma_{x_p}^2 & 0 & 0\\
0 &  \sigma_{y_p}^2 & 0 \\
0 & 0 & \sigma_{z_p}^2  \end{array} \right)
\end{equation} \end{linenomath*}
is the covariance matrix. We define the mean location
$\mu_{\mathbf{e}_p}$ and covariance matrix by the hypoDD optimum
solution and its uncertainties. It is important to note that hypoDD
must be used with SVD to obtain useful estimates of $\sigma_{x_p}$,
$\sigma_{y_p}$ and $\sigma_{z_p}$ because the errors reported by
conjugate gradient methods (LSQR) are grossly underestimated in
hypoDD \citep{dr_Waldhauser01a}.

We pose the location problem using the negative log likelihood
\begin{linenomath*} \begin{equation}
\label{eq-Lstar-tt-cwi}
\begin{array}{l}
 L(\mathbf{e}_1, \mathbf{e}_2, ...,
\mathbf{e}_1, \mathbf{e}_n) = - \sum_{i=1}^n
ln\left[P(\mathbf{e}_i|\Delta_{TT})\right] \\
\hspace{6em}  - \sum_{i=1}^{n-1}
\sum_{j=i+1}^n
ln\left[P(\delta_{CWIN}|\mathbf{e}_i,\mathbf{e}_j)\right],
\end{array}
\end{equation} \end{linenomath*}
where $(\mathbf{e}_1, \mathbf{e}_2, ..., \mathbf{e}_n)$ is the joint
location,
\begin{linenomath*} \begin{equation}
\label{eq-ttcomponent} \sum_{i=1}^n
ln\left[P(\mathbf{e}_i|\Delta_{TT})\right]
\end{equation} \end{linenomath*}
incorporates the arrival-time constraints and
\begin{linenomath*} \begin{equation}
\label{eq-codacomponent} \sum_{i=1}^{n-1} \sum_{j=i+1}^n
ln\left[P(\delta_{CWIN}|\mathbf{e}_i,\mathbf{e}_j)\right]
\end{equation} \end{linenomath*}
 the coda-waves.

We must differentiate $L$ to use the Polak-Ribiere conjugate
gradient technique of \citet{dr_Press87a}. The derivative of
$L(\mathbf{e}_1, \mathbf{e}_2, ..., \mathbf{e}_n)$ with respect to
$x_p$ is given by
\begin{linenomath*} \begin{equation}
\begin{array}{l}
\frac{\partial L}{\partial x_p} =  - \frac{\partial ln\left[P(\mathbf{e}_p|t_{DD})\right]}{\partial x_p}
- \sum_{i=p+1}^{N} \frac{ \partial \ln
\left[P(\delta_{CWIN}|\mathbf{e}_p,\mathbf{e}_i)\right]}{\partial
x_p} \\
\hspace{5em} - \sum_{j=1}^{p-1} \frac{ \partial \ln
\left[P(\delta_{CWIN}|\mathbf{e}_j,\mathbf{e}_p)\right]}{\partial
x_p}
\end{array}
\end{equation} \end{linenomath*}
where
\begin{linenomath*} \begin{equation}
\sum_{i=p+1}^{N} \frac{ \partial \ln
\left[P(\delta_{CWIN}|\mathbf{e}_p,\mathbf{e}_i)\right]}{\partial
x_p}
\end{equation} \end{linenomath*}
and
\begin{linenomath*} \begin{equation}
\sum_{j=1}^{p-1} \frac{ \partial \ln
\left[P(\delta_{CWIN}|\mathbf{e}_j,\mathbf{e}_p)\right]}{\partial
x_p}
\end{equation} \end{linenomath*}
are defined in Appendix \ref{sec-Appendix-derivatives_ofL} and
\begin{linenomath*} \begin{equation}
\begin{array}{l}
\frac{\partial ln\left[P(\mathbf{e}_p|t_{DD})\right]}{\partial x_p}
= -\frac{1}{2}[1,0,0]^T \Sigma^{-1}
[\mathbf{e}_p-\mu_{\mathbf{e}_p}] \\
\hspace{9em} -\frac{1}{2}
[\mathbf{e}_p-\mu_{\mathbf{e}_p}]^T \Sigma^{-1} [1,0,0].
\end{array}
\end{equation} \end{linenomath*}
Similarly, for the derivatives with respect to $y_p$ and $z_p$ we
have
\begin{linenomath*} \begin{equation}
\begin{array}{l}
\frac{\partial ln\left[P(\mathbf{e}_p|t_{DD})\right]}{\partial y_p}
= -\frac{1}{2} [0,1,0]^T \Sigma^{-1}
[\mathbf{e}_p-\mu_{\mathbf{e}_p}] \\
\hspace{9em} -\frac{1}{2}
[\mathbf{e}_p-\mu_{\mathbf{e}_p}]^T \Sigma^{-1} [0,1,0]
\end{array}
\end{equation} \end{linenomath*}
and
\begin{linenomath*} \begin{equation}
\begin{array}{l}
\frac{\partial ln\left[P(\mathbf{e}_p|t_{DD})\right]}{\partial z_p}
= -\frac{1}{2} [0,0,1]^T \Sigma^{-1}
[\mathbf{e}_p-\mu_{\mathbf{e}_p}] \\
\hspace{9em} -\frac{1}{2}
[\mathbf{e}_p-\mu_{\mathbf{e}_p}]^T \Sigma^{-1} [0,0,1].
\end{array}
\end{equation} \end{linenomath*}

Combining the arrival-time and coda-wave data offers two advantages.
Firstly, it combines independent constraints on the event locations
offering further confidence in the resulting solution. Secondly, the
arrival-time constraints in the form of equation
(\ref{eq-ttcomponent}) resolve the inherent non-uniqueness
of the CWI inversion that is associated with translation, rotation and reflection around a global
coordinate system. This means that it is no longer necessary to use
a local coordinate system and we can solve directly for location
with respect to a global reference. Collectively, these advantages
improve the behavior of the Polak-Ribiere optimization leading to
faster and more stable convergence. Consequently, we no longer need
to consider multiple randomly chosen starting locations.

\vspace{1em}
\subsection*{Example 7 - Combining arrival-time and CWI constraints}
Figure
\ref{fig-68Calaverasevents_ttandcoda1} illustrates the earthquake
locations obtained when we combine the arrival-time and coda-wave
data using all data (left) and five stations (right). The linear
features observed in the original hypoDD inversions (see Fig.
\ref{fig-69Calaverasevents_eg1}) are evident in both cases. However,
the coda-waves introduce a scatter around these streaks. That is,
the locations in figure \ref{fig-68Calaverasevents_ttandcoda1}
result from a trade-off between hypoDD's desire to place the events
on linear features and the coda-waves voracity to push them away
from streaks. When all stations are used the hypoDD constraints are
strong and little off-streak scatter is introduced. As we reduce
hypoDD's leverage by decreasing the number of stations to five, we
observe an increase in off-streak scatter resulting from the
enhanced influence of the coda.


\subsection*{Example 8 - Combining CWI and arrival-times when the arrival-times constrain a limited number of events}

In intraplate regions such as Australia it is common to deploy
temporary seismometers to monitor aftershocks for significant events
\citep{dr_Bowman90a, dr_Leonard02a}. Traditionally, these
deployments facilitate a higher accuracy of location for events
occuring during the deployment period. Using our combined inversion
it is possible to re-locate all events by employing the detailed
arrival-time data when the temporary network is in-situ and using
coda-waves from network stations when the deployment is absent. The
hypothesis, to be tested in this section, is that conducting such a
combined inversion will improve the location accuracy of events
outside the deployment period.

An estimate of the cummulative number of aftershocks $N(t)$ after
$t$ days can be modeled by the modified Omori formula
\begin{linenomath*} \begin{equation}
\label{eq:CumOmori}
 N(t) = K \frac{c^{1-p} + (t+c)^{1-p}}{p-1}
\end{equation} \end{linenomath*}
\citep{dr_Utsu95a}.
The empirically derived constants, $K$, $C$ and $p$ vary between
tectonic settings. For example, using recorded aftershocks with
$M\ge3.2$ of the  Hokkaido-Nansei-Oki, Japan $M_s=7.8$ earthquake of
12 July 1993, \citet{dr_Utsu95a} obtained maximum likelihood
estimates for $K$, $p$ and $c$ of 906.5, 1.256 and 1.433,
respectively.  With these empirically derived values an array
deployed within 4 days and left for 150 days will record roughly one
half of the aftershocks occurring within the first 1000 days. That
is,
\begin{linenomath*} \begin{equation}
\frac{N(150+4)-N(4)}{N(1000)} = \frac{2257-934}{2626} \approx 0.5.
\end{equation} \end{linenomath*}
This is illustrated in Figure \ref{fig:Omorifigure} which shows
the best fitting Omori Formula separated into segments before, during 
and after the pseudo temporary
deployment.

With this idea of a temporary deployment in mind we have another
attempt at relocating the Calaveras earthquakes. In Example 8 we
consider the arrival-time constraints on half (34) of the earthquakes
and incorporate coda-wave data from a single station for all 68
earthquakes. The combined inversion is shown in column 1 of Figure
\ref{fig-68Calaverasevents_ttsubsetandcoda1}. The inversion result
is similar to the combined inversion when all arrival-time data are
incorporated (see Fig. \ref{fig-68Calaverasevents_ttandcoda1}). The
slight increase in scatter observed here can be explained by the
events with no arrival-time constraints and the tendency of the coda
to push events away from streaks.

Remarkably, the combined coda-wave and arrival-time inversion locates
all 68 earthquakes to an accuracy similar to the inversions with all
data. In contrast when arrival-time data are used alone it is only
possible to locate the 34 events recorded by the pseudo temporary
deployment. This
ability of  coda-waves to constrain the location of events recorded
by a single station creates new opportunities for understanding
earthquakes in regions with limited station coverage.

\vspace{2em}
\begin{centering}
\section*{Discussion and Conclusions}
\end{centering}

Coda-wave interferometry is an emerging technique for constraining
earthquake location. The technique relies on the interference
between coda-waves of closely located events and is hence useful for
studying earthquake clusters and/or aftershock sequences. Coda-wave
constraints are independent of arrival-times and can be used in
isolation or combination with early onset body waves. The strength
of coda is that it is possible to constrain earthquake location from
a single station, an outcome demonstrated most clearly by Figures
\ref{fig-CWIreducesstats} and
\ref{fig-68Calaverasevents_ttsubsetandcoda1}.

Coda-wave interferometry offers a new technique for understanding
earthquakes in intraplate areas with sparse networks and poor
azimuthal coverage. In particular, the ability to combine coda-wave
constraints with arrival-times makes it possible to link well
constrained events from a temporary deployment with those recorded
outside the deployment period. All that is required to achieve this
is at least one network station which has recorded sufficient events
from both periods. CWI facilitates the location of poorly recorded
events to an accuracy approaching those recorded during the
temporary deployment and therefore opens new avenues for imaging
intraplate fault structures and improving our understanding of
intraplate seismicity and earthquake hazard. Importantly, this analysis 
can be conducted for any historical aftershock sequence or earthquake swarm
recorded by a temporay deployment, Our technique is, in that sense, related
to the retorspective sesimological observation technique of 
\citet{dr_Curtis12a_EPSL} that utilizes interferometry to obtain seismic signals
on newly installed sensors regardless of whether the event occurs before, 
during or after the physical installation of the sensor. 

Another potential application of CWI is in the area of hydraulic
fracturing such as hot rock geothermal projects, petroleum reservoir engineering,
tight gas extraction, CO$_2$ geosequestration and/or underground brine injection.
Monitoring pumping-induced micro earthquakes
is a key step in understanding the migration of fluids in such
reservoirs. There is a trade-off in the ability of surface deployed
networks to locate events which are small and/or deep. Downhole
seismic monitoring is likely to play increasingly important roles in
deep reservoir projects. CWI creates new possibilities to monitor
pumping induced micro earthquakes from fewer boreholes and hence
dramatically reduce the costs of reservoir monitoring at large
depths. It may also be possible to utilize coda for understanding
hazard in tunneled mining operations where the location of deep
tunnels prohibits azimuthal coverage of induced events.

\vspace{2em}
\begin{centering}
\section*{Data and Resources}
\end{centering}
We thank the Northern California Earthquake Data Center (NCEDC) for
providing the Calaveras data and the Northern California Seismic
Network (NCSN), U.S. Geological Survey, Menlo Park and Berkeley
Seismological Laboratory, University of California, Berkeley for
contributing it to the NCEDC. The waveforms can be downloaded from \\
http://www.ncedc.org/ncedc/access.html (last accessed August 2012). 
We also acknowledge Felix
Waldhauser and William Ellsworth, the authors of the openly
available Double Difference location algorithm, hypoDD which can be
downloaded from \\
http://www.ldeo.columbia.edu/~felixw/hypoDD.html
(last accessed August 2012).
The International Sesimological Centre can be found at \\
http://www.isc.ac.uk/ (last accessed December 2012).
The National Earthquake
Information
Center catalogue can be accessed from \\
http://earthquake.usgs.gov/earthquakes/eqarchives/epic/
(last accessed December 2012).

\vspace{2em}
\begin{centering}
\section*{Acknowledgments}
\end{centering}

Geoscience Australia, the Research School of Earth Sciences at The
Australian National University, and the Center for Wave Phenomena at
the Colorado School of Mines, are acknowledged for supporting this
research. The paper is published with permission of the CEO
Geoscience Australia. Work was conducted as part of an Australian
Research Council Discovery Project (DP0665111).  This paper has
benefited significantly from: reviews by Trevor Allen and Clive Collins
at Geoscience Australia, the BSSA editorial team, Andrew Curtis from 
the School of GeoSciences at the University of Edinburgh and an anonymous 
reviewer. The authors have also benefited from comments and advice received from
Felix Waldhauser on this and earlier research on the application of
CWI to earthquake location.

%=============================================
% Bibliography
\vspace{2em}
%\bibliography{../refs/drrefs}  %Uncomment when generating bibliography


\newcommand{\areps}{\textit{Ann.\ Rev.\ Earth Planet\ Sci.}}
\newcommand{\bssa}{\textit{Bull.\ Seism.\ Soc.\ Am.}}
\newcommand{\eos}{\textit{Eos Trans.\ AGU}} 
\newcommand{\eps}{\textit{Earth~Planets~Space}}
\newcommand{\epsl}{\textit{Earth~Planet.\ Sci.\ Lett.}}
\newcommand{\gca}{\textit{Geochim.\ Cosmochim.\ Acta}}
\newcommand{\geo}{\textit{Geology}}
\newcommand{\geop}{\textit{Geophysics}}
\newcommand{\gji}{\textit{Geophys.\ J.\ Int.}}
\newcommand{\gjras}{\textit{Geophys.\ J.\ R.\ Astr.\ Soc.}}
\newcommand{\grl}{\textit{Geophys.\ Res.\ Lett.}}
\newcommand{\gsab}{\textit{Geol.\ Soc.\ Am.\ Bull.}}
\newcommand{\gs}{\textit{Geophys.\ Surv.}}
\newcommand{\jgr}{\textit{J.\ Geophys.\ Res.}}
\newcommand{\jpo}{\textit{J.\ Phys.\ Oceanogr.}} 
\newcommand{\jseis}{\textit{J.~Seismology}}
\newcommand{\mnras}{\textit{Mon.\ Not.\ R.\ astr.\ Soc.}} 
\newcommand{\pag}{\textit{Pure Appl.\ Geophys.}}
\newcommand{\pepi}{\textit{Phys.\ Earth Planet.\ Inter.}}
\newcommand{\rg}{\textit{Rev.\ Geophys.}}
\newcommand{\tecto}{\textit{Tectonophysics}}
\newcommand{\jpe}{\textit{J. Phys. Earth}}  % Added by DR
\newcommand{\srl}{\textit{Seism. Res. Let.}}  % Added by DR

\begin{thebibliography}{45}
\providecommand{\natexlab}[1]{#1}
\expandafter\ifx\csname urlstyle\endcsname\relax
  \providecommand{\doi}[1]{doi:\discretionary{}{}{}#1}\else
  \providecommand{\doi}{doi:\discretionary{}{}{}\begingroup
  \urlstyle{rm}\Url}\fi

\bibitem[{\textit{Ake et~al.}(2005)\textit{Ake, O'{C}onnell, and
  Block}}]{dr_Ake05a}
Ake, J., D.~O'{C}onnell, and L.~Block (2005), Deep-injection and closely
  monitored induced seismicity at {P}aradox {V}alley, {C}olorado,
  \bssa, \textit{95}(2),
  664--683.

\bibitem[{\textit{Aki}(1969)}]{dr_Aki69a}
Aki, K. (1969), Analysis of the seismic coda of local earthquakes as scattered
  waves, \jgr, \textit{74}(2), 615--631.

\bibitem[{\textit{Aster et~al.}(2005)\textit{Aster, Borchers, and
  Thurber}}]{dr_Aster05a}
Aster, R.~C., B.~Borchers, and C.~H. Thurber (2005), \textit{Parameter
  estimation and inverse problems}, \textit{International Geophysics Series},
  vol.~90, Elsevier Academic Press, USA.

\bibitem[{\textit{Bond\'ar et~al.}(2004)\textit{Bond\'ar, Myers, Engdahl, and
  Bergman}}]{dr_Bondar04a}
Bond\'ar, I., S.~C. Myers, E.~R. Engdahl, and E.~A. Bergman (2004), Epicentre
  accuracy based on seismic network criteria, \gji, \textit{156}, 483--496.

\bibitem[{\textit{Bowman et~al.}(1990)\textit{Bowman, Gibson, and
  Jones}}]{dr_Bowman90a}
Bowman, J.~R., G.~Gibson, and T.~Jones (1990), Aftershocks of the 1988
  {J}anuary 22 {T}ennant {C}reek, {A}ustralia intraplate earthquakes: evidence
  for a complex thrust-fault geometry, \gji, \textit{100}, 87--97.

\bibitem[{\textit{Campbell}(2003)}]{dr_Campbell03a}
Campbell, K.~W. (2003), Strong motion attenuation, in \textit{International
  Handbook of Earthquake and Engineering Seismology}, vol.~B, edited by
  W.~H.~K. Lee, H.~Kanamori, P.~C. Jennings, and C.~Kisslinger, chap.~60, pp.
  1003--1012, Academic Press, London.

\bibitem[{\textit{Curtis and Snieder}(2002)}]{dr_Curtis02a}
Curtis, A., and R.~Snieder (2002), Probing the {E}arth's interior with seismic
  tomography, in \textit{International Handbook of Earthquake Engineering
  Seismology}, vol.~{A}, edited by W.~H. Lee, H.~Kanamori, P.~C. Jennings, and
  C.~Kisslinger, chap.~52, pp. 861--874, Academic Press, London.

\bibitem[{\textit{Curtis et~al.}(2012)}]{dr_Curtis12a_EPSL}
Curtis, A., Behr, Y., Entwistle, E., Galetti, E., Townend J. Bannister, S. (2012),
The benefit of hindsight in observational science: {R}etrospective
seismological observations, \epsl, \textit{345--348}, 212--220.

\bibitem[{\textit{Deichmann and Garcia-{F}ernandez}(1992)}]{dr_Deichmann92a}
Deichmann, N., and M.~Garcia-{F}ernandez (1992), Rupture geometry from
  high-precision relative hypocentre locations of microearthquake clusters,
  \gji, \textit{110}, 501--517.

\bibitem[{\textit{Douglas}(1967)}]{dr_Douglas67a}
Douglas, A. (1967), Joint epicentre determination, \textit{Nature},
  \textit{215}, 47--48.

\bibitem[{\textit{Frankel et~al.}(2000)\textit{Frankel, Mueller, Barnhard,
  Leyendecker, Wesson, Harmsen, Klein, Perkins, Dickman, Hanson, and
  Hopper}}]{dr_Frankel00a}
Frankel, A.~D., C.~S. Mueller, T.~P. Barnhard, E.~V. Leyendecker, R.~L. Wesson,
  S.~C. Harmsen, F.~W. Klein, D.~M. Perkins, N.~C. Dickman, S.~L. Hanson, and
  M.~G. Hopper (2000), {USGS} {N}ational seismic hazard maps,
  \textit{Earthquake Spectra}, \textit{16}(1), 1--19.

\bibitem[{\textit{Fr\`emont and Malone}(1987)}]{dr_Fremont87a}
Fr\`emont, M.-J., and S.~D. Malone (1987), High precision relative locations of
  earthquakes at {M}ount {St.} {H}elens, \jgr, \textit{92}(B10), 10,223--10,236.

\bibitem[{\textit{Got et~al.}(1994)\textit{Got, Fr\`echet, and
  Klein}}]{dr_Got94a}
Got, J.-L., J.~Fr\`echet, and F.~W. Klein (1994), Deep fault plane geometry
  inferred from multiplet relative relocation beneath the south flank of
  {K}ilauea, \jgr, \textit{99}(B8),
  15,375--15,386.

\bibitem[{\textit{Gutenberg}(1945)}]{dr_Gutenberg45a}
Gutenberg, B. (1945), Amplitudes of surface waves and magnitudes of shallow
  earthquakes, \bssa,
  \textit{35}, 3--12.

\bibitem[{\textit{Ito}(1985)}]{dr_Ito85a}
Ito, A. (1985), High resolution relative hypocenters of similar earthquakes by
  cross-spectral analysis method, \jpe,
  \textit{33}, 279--294.

\bibitem[{\textit{Kennett et~al.}(1995)\textit{Kennett, Engdahl, and
  Buland}}]{dr_Kennett95a}
Kennett, B. L.~N., E.~R. Engdahl, and R.~Buland (1995), Constraints on seismic
  velocities in the {E}arth from traveltimes, \gji, \textit{122}, 108--124.

\bibitem[{\textit{Kennett et~al.}(2004)\textit{Kennett, Fishwick, and
  Heintz}}]{dr_Kennett04a}
Kennett, B. L.~N., S.~Fishwick, and M.~Heintz (2004), Lithospheric structure in
  the {A}ustralian region - a synthesis of surface wave and body wave studies,
  \textit{Exploration Geophysics}, \textit{35}, 242--250.

\bibitem[{\textit{Lees}(1998)}]{dr_Lees98a}
Lees, J.~M. (1998), Multiplet analysis at {C}oso {G}eothermal, \bssa, \textit{88}(5), 1127--1143.

\bibitem[{\textit{Leonard}(2002)}]{dr_Leonard02a}
Leonard, M. (2002), The {B}urakin {WA} earthquake sequence {S}ept 2000 --
  {J}une 2002, in \textit{Total Risk Management in the Privatised Era},
  \textit{Australian Earthquake Engineering Society Conference}, vol. 10th,
  edited by M.~Griffith, D.~Love, P.~Mc{B}ean, A.~Mc{D}ougall, and B.~Butler,
  pp. 22(1)--22(5), AEES, University of Adelaide.

\bibitem[{\textit{Nadeau and Mc{E}villy}(1997)}]{dr_Nadeau97a}
Nadeau, R.~M., and T.~V. Mc{E}villy (1997), Seismological studies at
  {P}arkfield {V}: {C}haracteristic microearthquake sequences as fault--zone
  drilling targets, \bssa,
  \textit{87}(6), 1463--1472.

\bibitem[{\textit{Pavlis}(1992)}]{dr_Pavlis92a}
Pavlis, G.~L. (1992), Appraising relative earthquake location errors,
  \bssa, \textit{82}(2),
  836--859.

\bibitem[{\textit{Press et~al.}(1987)\textit{Press, Flannery, Teukolsky, and
  Vetterling}}]{dr_Press87a}
Press, W.~H., B.~P. Flannery, S.~A. Teukolsky, and W.~T. Vetterling (1987),
  \textit{Numerical Recipes: The Art of Scientific Computing}, Cambridge
  University Press, USA.

\bibitem[{\textit{Richter}(1935)}]{dr_Richter35a}
Richter, C.~F. (1935), An instrumental earthquake magnitude scale,
  \bssa, \textit{25}(1),
  1--32.

\bibitem[{\textit{Robinson et~al.}(2006)\textit{Robinson, Dhu, and
  Schneider}}]{dr_Robinson06b}
Robinson, D., T.~Dhu, and J.~Schneider (2006), Practical probabilistic seismic
  risk analysis: {A} demonstration of capability, \srl, \textit{77}(4), 452--458.

\bibitem[{\textit{Robinson et~al.}(2007{\natexlab{a}})\textit{Robinson,
  Sambridge, and Snieder}}]{dr_Robinson07b}
Robinson, D.~J., M.~Sambridge, and R.~Snieder (2007{\natexlab{a}}), Constraints
  on coda wave interferometry estimates of source separation: The 2.5d acoustic
  case, \textit{Exploration Geophysics}, \textit{38}(3), 189--199.

\bibitem[{\textit{Robinson et~al.}(2007{\natexlab{b}})\textit{Robinson,
  Snieder, and Sambridge}}]{dr_Robinson07c}
Robinson, D.~J., R.~Snieder, and M.~Sambridge (2007{\natexlab{b}}), Using coda
  wave interferometry for estimating the variation in source mechanism between
  double couple events, \jgr, \textit{112},
  b12302, doi:10.1029/2007JB004925.

\bibitem[{\textit{Robinson et~al.}(2011)\textit{Robinson, Sambridge, and
  Snieder}}]{dr_Robinson11a}
Robinson, D.~J., M.~Sambridge, and R.~Snieder (2011), A probabilistic approach
  for estimating the separation between a pair of earthquakes directly from
  their coda waves, \jgr, \textit{B04309},
  1--17.

\bibitem[{\textit{Rubin}(2002)}]{dr_Rubin02a}
Rubin, A.~M. (2002), Aftershocks of microearthquakes as probes of the mechanics
  of rupture, \jgr, \textit{107}(B7,2142),
  10.1029/2001JB000,496.

\bibitem[{\textit{Rubin et~al.}(1999)\textit{Rubin, Gillard, and
  Got}}]{dr_Rubin99a}
Rubin, A.~M., D.~Gillard, and J.-L. Got (1999), Streaks of microearthquakes
  along creeping faults, \textit{Nature}, \textit{400}, 635--641.

\bibitem[{\textit{Schaff et~al.}(2002)\textit{Schaff, Bokelmann, and
  Beroza}}]{dr_Schaff02a}
Schaff, D.~P., G.~H.~R. Bokelmann, and G.~C. Beroza (2002), High-resolution
  image of {C}alaveras {F}ault seismicity, \jgr, \textit{107}(B9), 2186, doi:10.1029/2001JB000,633.

\bibitem[{\textit{Shearer et~al.}(2005)\textit{Shearer, Hauksson, and
  Lin}}]{dr_Shearer05a}
Shearer, P., E.~Hauksson, and G.~Lin (2005), Southern {C}alifornia hypocenter
  relocation with waveform cross-correlation, {P}art 2: {R}esults using
  source-specific station terms and cluster analysis, \bssa, \textit{95}(3), 904--915.
  doi:10.1785/0120040,168.

\bibitem[{\textit{Shearer}(1999)}]{dr_Shearer99a}
Shearer, P.~M. (1999), \textit{Introduction to Seismology}, Cambridge
  University Press, USA, 260pp.

\bibitem[{\textit{Sipkin}(2002)}]{dr_Sipkin02a}
Sipkin, S.~A. (2002), {USGS} earthquake moment tensor catalog, in
  \textit{International Handbook of Earthquake Engineering Seismology},
  vol.~{A}, edited by W.~H. Lee, H.~Kanamori, P.~C. Jennings, and
  C.~Kisslinger, chap.~50, pp. 823--825, Academic Press, London.

\bibitem[{\textit{Slunga et~al.}(1995)}]{dr_Slunga95a}
Slunga, R., R{\"o}gnvaldsson, {S. Th.} and B{\"o}dvarsson, R. (1995),
Absolute and relative locations of similar events with application to microearthquakes in southern {I}celand,
\gji,\textit{123}(2),409--419.

\bibitem[{\textit{Snieder}(1999)}]{dr_Snieder99a}
Snieder, R. (1999), Imaging and averaging in complex media, in \textit{Diffuse
  waves in complex media}, \textit{NATO Science Series C}, vol. 531, edited by
  J.~P. Fouque, pp. 405--454, Kluwer Academic Publishers.

\bibitem[{\textit{Snieder}(2006)}]{dr_Snieder06a}
Snieder, R. (2006), The theory of coda wave interferometry, \pag, 
\textit{163}, 455--473.

\bibitem[{\textit{Snieder and Vrijlandt}(2005)}]{dr_Snieder05a}
Snieder, R., and M.~Vrijlandt (2005), Constraining the source separation with
  coda wave interferometry: Theory and application to earthquake doublets in
  the {H}ayward {F}ault, {C}alifornia, \jgr, \textit{110}(B04301), doi:10.1029/2004JB003317.

\bibitem[{\textit{Spencer and Gubbins}(1980)}]{dr_Spencer80a}
Spencer, C., and D.~Gubbins (1980), Travel-time inversion for simultaneous
  earthquake location and velocity structure determination in laterally varying
  media, \gjras,
  \textit{63}, 95--116.

\bibitem[{\textit{Stirling et~al.}(2002)\textit{Stirling, Mc{V}erry, and
  Berrryman}}]{dr_Stirling02a}
Stirling, M.~W., G.~H. Mc{V}erry, and K.~R. Berrryman (2002), A new seismic
  hazard model for {N}ew {Z}ealand, \bssa, \textit{92}(5), 1878--1903.

\bibitem[{\textit{Toro et~al.}(1997)\textit{Toro, Abrahamson, and
  Schneider}}]{dr_Toro97a}
Toro, G.~R., N.~A. Abrahamson, and J.~F. Schneider (1997), Model of strong
  ground motions from earthquakes in {C}entral and {E}astern {N}orth {A}merica:
  {B}est estimates and uncertainties, \srl,
  \textit{68}(1), 41--57.

\bibitem[{\textit{Utsu et~al.}(1995)\textit{Utsu, Ogata, and
  Matsu'ura}}]{dr_Utsu95a}
Utsu, T., Y.~Ogata, and R.~S. Matsu'ura (1995), The {C}entenary of the {O}mori
  {F}ormula for a decay law of aftershock activity, \jpe, \textit{43}, 1--33.

\bibitem[{\textit{Van{D}ecar and Snieder}(1994)}]{dr_VanDecar94a}
Van{D}ecar, J.~C., and R.~Snieder (1994), Obtaining smooth solutions to large
  linear inverse problems, \textit{Geophysics}, \textit{59}, 818--829.

\bibitem[{\textit{Waldhauser}(2001)}]{dr_Waldhauser01a}
Waldhauser, F. (2001), hypo{DD} -- a program to compute double-difference
  hypocenter locations (hypo{DD} version 1.0 - 03/2001), \textit{Open file
  report 01-113}, United States Geological Survey, Menlo Park, California.

\bibitem[{\textit{Waldhauser and Ellsworth}(2000)}]{dr_Waldhauser00a}
Waldhauser, F., and W.~L. Ellsworth (2000), A double--difference earthquake
  location algorithm: method and application to the northern {H}ayward {F}ault,
  {C}alifornia, \bssa,
  \textit{90}(6), 1353--1368.

\bibitem[{\textit{Waldhauser and Ellsworth}(2002)}]{dr_Waldhauser02a}
Waldhauser, F., and W.~L. Ellsworth (2002), Fault structure and mechanics of
  the {H}ayward {F}ault, {C}alifornia, from double--difference earthquake
  locations, \jgr, \textit{107}(B3),
  10.1029/2000JB000,084.

\bibitem[{\textit{Waldhauser and Schaff}(2008)}]{dr_Waldhauser08a}
Waldhauser, F., and D.~P. Schaff (2008), Large-scale relocation of two decades
  of {N}orthern {C}alifornia seismicity using cross-correlation and
  double-difference methods, \jgr,
  \textit{133}, {B08311, doi10.1029/2007JB005479}.

\bibitem[{\textit{Waldhauser et~al.}(1999)\textit{Waldhauser, Ellsworth, and
  Cole}}]{dr_Waldhauser99a}
Waldhauser, F., W.~L. Ellsworth, and A.~Cole (1999), Slip-parallel lineations
  on the {N}orthern {H}ayward {F}ault, {C}alifornia, \grl, \textit{26}(23), 3525--3528.

\end{thebibliography}





\vspace{2em}
\begin{centering}
\section*{Authors' Affiliations, Adresses}
\end{centering}

\begin{tabular}{lp{0.6\textwidth}}
 & \\
David Robinson: & Earth Monitoring and Hazard Group \\
 &  Geoscience Australia \\
 & GPO Box \emph{383} \\
 & Canberra ACT \emph{2601} Australia \\
 & E-mail: david.robinson@ga.gov.au\\
 & \\
 & Also at: Research School of Earth Sciences \\
 & Australian National University \\ 
 & Canberra ACT \emph{0200}, Australia \\
 & E-mail: david.robinson@anu.edu.au \\
 & \\
 Malcolm Sambridge: & Research School of Earth Sciences \\
 & Australian National University \\ 
 & Canberra ACT \emph{0200}, Australia \\
  & \\
Roel Snieder: & Center for Wave Phenomena and Department of Geophysics \\
 & Colorado School of Mines \\
 & Golden CO \emph{80401-1887}, USA \\
 & \\
Juerg Hauser: & CSIRO Earth Science and Resource Engineering \\
 & Dick Perry Av \\
 & Kensington WA \emph{6151} Australia
\end{tabular}

\clearpage

%\begin{centering}
%\section*{Tables}
%\end{centering}
%%=======================================================================================
% Table 1

\begin{table}
\caption{Location examples for the 68 Calaveras earthquakes.}
\label{tab:examples}
\begin{tabular}{ll}
\hline
Example 5 & Comparison of CWI, catalogue and hypoDD \\
 & locations (using all available data). \\
Example 6 & Exploration of station dependance for CWI and \\
 & hypoDD (using a subset of data). \\
Example 7 & Combined use of CWI and arrival-time data \\
& with all and a reduced number of stations. \\
Example 8 & Combined use of CWI and arrival-time data \\
 & when arrival-times constrain only 50\% of the events. \\
 \hline
\end{tabular}
\end{table}

%%=======================================================================================
% Table 2

\begin{table}
\caption[Conditions for identifying unsuitable waveforms when
applying CWI] {Conditions used to identify unsuitable waveforms
before applying CWI \citep[Originally published as Table
5][]{dr_Robinson11a}} \label{tab:-conditions4unsuitablewaveform}
\begin{tabular}{|l|p{0.7\textwidth}|}
\hline
 & \textbf{condition} \\
\hline
1 & waveform is clearly corrupted \\
2 & waveform indicates recording of more then one event \\
3 & signal to noise ratio is obviously low \\
4 & there is insufficient coda recorded after the \\
 & first arrivals \\
5 & there is insufficient recording before the arrivals \\
 &  (needed for accurate noise energy estimate) \\
\hline
\end{tabular}
\end{table}


\clearpage

%\begin{centering}
%\section*{Figure Captions}
%\end{centering} 
%%=======================================================================================

%Figure 1
\begin{figure}
%\includegraphics[width = 20pc]{diags/locs_2D_50eq_1.eps}
%\includegraphics[width = 20pc]{Figure1_c.eps}
\caption{Example 1 - Synthetic relocation of 50 earthquakes in 2D
using all constraints with noise $\bar{\sigma}_N=0.02$. Actual and
optimization event locations are identified by triangles and circles,
respectively.} \label{fig-2D50eq-relocation_eg1}
\end{figure}

%%=======================================================================================

%Figure 2
\begin{figure}
%\includegraphics[width = 20pc]{diags/locs_2D_50eq_3.eps}
%\includegraphics[width = 20pc]{Figure2_c.eps}
\caption{Example 2 - Synthetic relocation of 50 earthquakes in 2D
using all constraints with noise $\bar{\sigma}_N= 2
\epsilon(\delta_t)$.
 Actual and optimization event locations
are identified by triangles and circles, respectively.}
\label{fig-2D50eq-relocation_eg3}
\end{figure}

%%=======================================================================================

% Figure 3
\begin{figure}
%\noindent\includegraphics[width = 20pc]{../../thesis_version2/diags/eq_location_optimisation/synth2Dmulti/ressummary_2Dsynth50eq.eps}
%\noindent\includegraphics[width=20pc]{diags/synth2Dmulti/ressummary_2Dsynth50eq.eps}
%\noindent\includegraphics[width=20pc]{Figure3_c.eps}
\caption{Example 3 - Statistical measures of error in the
 solutions for the 2D synthetic cases when all and best
optimization results are considered. The statistics $\Delta_{max}$
and $\Delta_\mu$  are the maximum and mean coordinate error,
respectively. The bottom subplot shows the average minimum number of
branches required to link the 2450 pairs.}
 \label{fig:optimisationresults-2Dsynth}
\end{figure}

%%=======================================================================================

% Figure 4
\begin{figure}
%\noindent\includegraphics[width = 20pc]{../../thesis_version2/diags/eq_location_optimisation/synth3Dmulti/ressummary_3Dsynth50eq.eps}
%\noindent\includegraphics[width=20pc]{diags/synth3Dmulti/ressummary_3Dsynth50eq.eps}
%\noindent\includegraphics[width=20pc]{Figure4_c.eps}
\caption{Example 4 - Statistical measures of error in the
optimization solutions for the 3D synthetic cases when all
and best results are considered. The statistics
$\Delta_{max}$ and $\Delta_\mu$ are the maximum and mean coordinate
error, respectively. The absence of the lines below
60\% and 30\% indicates a breakdown in the solutions when all or
best optimization result(s) are considered, respectively.}
\label{fig:optimisationresults-3Dsynth}
\end{figure}

%%=======================================================================================

% Figure 5
\begin{figure}
%\noindent\includegraphics[width=20pc]{diags/CalaverasMap/gmt_california/CaliforniaCalaverasMap1.eps}
%\noindent\includegraphics[width=20pc]{Figure5.eps} 
\caption{Map
showing location of the Calaveras cluster (star) and 805
seismic stations (triangles).}
\label{fig:-eqopti-California-Calaveras}
\end{figure}

%%=======================================================================================
% Figure 6

% Now we have the SVD version
\begin{figure}
%\includegraphics{diags/CalaverasLoc1_hypoDD_SVD.eps}
%\includegraphics{Figure6_bw.eps}
\caption{Example 5 - Comparison of relative earthquake locations
using three different methods: catalogue location (column 1), CWI
(column 2) and hypoDD (column 3). Note that in the case of the
hypoDD and CWI inversions we consider only the 68 earthquakes in
black, the gray catalogue locations for the remaining 240 (308-68)
earthquakes are shown for the purpose of orientation only. In this and subsequent
similar figures (Figures \ref{fig-CWIreducesstats}, \ref{fig-HYPODDreducesstats},
\ref{fig-68Calaverasevents_ttandcoda1} and \ref{fig-68Calaverasevents_ttsubsetandcoda1}) 
$x$ is defined as positive towards the east, y is positive towards the north and z is 
positive down.}
\label{fig-69Calaverasevents_eg1}
\end{figure}
%%=======================================================================================

% Figure 7
\begin{figure}
%\noindent\includegraphics[width=20pc]{diags/CalaverasMap/matlab/Calaveras_substationmap}
%\noindent\includegraphics[width=20pc]{Figure7.eps} 
\caption{Location
of the 10 stations (triangles) used to relocate the Calaveras events
in Examples 6 to 8. Stations are removed one at a time according to
the order defined by the bracketed numbers. That is, JRR is the first station to 
be removed, JHL is the second and so on. Events are indicated with circles.}
\label{fig:-eqopti-Calaveras-substations}
\end{figure}

%%=======================================================================================

%Figure 8
\begin{figure}
%\includegraphics[angle=90,height = 50pc]{diags/CalaverasLoc2.eps}
%\includegraphics[angle=90,height = 50pc]{Figure8_bw.eps}
\caption{Example 6 - CWI relative locations with reduced stations. 
Axes as defined in Figure \ref{fig-69Calaverasevents_eg1}.
\hspace{20em}}
\label{fig-CWIreducesstats}
\end{figure}

%%=========================================================================
% Figure 9

% This is the version using hypoDD with SVD
\begin{figure}
%\includegraphics[height = 25pc]{diags/CalaverasLoc3_hypoDD_SVD.eps}
%\includegraphics[height = 25pc]{Figure9_bw.eps}
\caption{Example 6 - HypoDD (SVD) relative locations with reduced
stations. Axes as defined in Figure \ref{fig-69Calaverasevents_eg1}. 
\hspace{20em} }
\label{fig-HYPODDreducesstats}
\end{figure}
%%=========================================================================

%Figure 10

% This is the version using hypoDD with SVD
\begin{figure}
%\noindent\includegraphics[width=20pc]{diags/CalaverasLoc4_hypoDD_SVD.eps}
%\noindent\includegraphics[width=20pc]{Figure10_c.eps}
\caption{Example 6 - Number of constrainable events $nE$ in the CWI
and hypoDD inversions as a function of the number of stations considered
(top). Mean (middle) and maximum (bottom) of the difference computed
between the reduced station inversion results (CWI and hypoDD) and
the complete hypoDD locations for all 308 events. }
\label{fig-statremoval_summarystats}
\end{figure}

%%=========================================================================

% Figure 11

% This is the version using hypoDD with SVD
\begin{figure}
%\includegraphics{diags/CalaverasLoc5_hypoDD_SVD.eps}
%\includegraphics{Figure11_bw.eps}
\caption{Example 7 - Combined HypoDD (SVD) and CWI relative
locations using data form all stations (left) and 5 stations
(right). Axes as defined in Figure \ref{fig-69Calaverasevents_eg1}.} 
\label{fig-68Calaverasevents_ttandcoda1}
\end{figure}


%%=========================================================================

% Figure 12

\begin{figure}
%\noindent\includegraphics[width = 20pc]{diags/OmoriFigure.eps}
%\noindent\includegraphics[width = 20pc]{Figure12_c.eps}
\caption{Modeled cumulative number of aftershocks for the
Hokkaido-Nansei-Oki, Japan $M_s=7.8$ earthquake of 12 July 1993
using equation (\ref{eq:CumOmori}). The leftmost, middle
and rightmost lines signify aftershocks occurring before, during
and after the deployment of a pseudo temporary array installed 4
days after the main shock and left for 150 days. A temporary
deployment of this kind will record roughly 50\% of the aftershocks
in the 1000 days following the mainshock. } \label{fig:Omorifigure}
\end{figure}

%%=========================================================================

% Figure 13

% This is the version using hypoDD with SVD
\begin{figure}
%\includegraphics{diags/CalaverasLoc6_hypoDD_SVD.eps}
%\includegraphics{Figure13_bw.eps}
\caption{Example 8 - Mimicking the deployment of a temporary network
by ignoring data from all but station CCO for 50\% (or 34) of the 68
events. Relative locations are shown for the combined CWI and arrival-time 
inversion (left) and the inversion with arrival-times only
(right). Only by combining the data is it possible to locate all 68
events. Furthermore, combining the data leads to a solution more
consistent with Figure \ref{fig-69Calaverasevents_eg1}. Axes as defined 
in Figure \ref{fig-69Calaverasevents_eg1}.}
\label{fig-68Calaverasevents_ttsubsetandcoda1}
\end{figure}
%%=========================================================================


%\clearpage
%\begin{centering}
%\section*{Figure Captions}
%\end{centering} 
%%=======================================================================================

%Figure 1
%\noindent\includegraphics[width = 20pc]{Figure1_c.eps} \\
%\textbf{Figure 1:} 

%%=======================================================================================

%Figure 2
%\clearpage
%\noindent\includegraphics[width = 20pc]{Figure2_c.eps} \\
%\textbf{Figure 2:} 

%%=======================================================================================

% Figure 3
%\clearpage
%\noindent\includegraphics[width=20pc]{Figure3_c.eps} \\
%\textbf{Figure 3:} 

%%=======================================================================================

% Figure 4
%\clearpage
%\noindent\includegraphics[width=20pc]{Figure4_c.eps} \\
%\textbf{Figure 4:} 

%%=======================================================================================

% Figure 5
%\clearpage
%\noindent\includegraphics[width=20pc]{Figure5.eps} \\
%\textbf{Figure 5:} 

%%=======================================================================================
% Figure 6
%\clearpage
%\includegraphics{Figure6_bw.eps} \\
%\textbf{Figure 6:} 

%%=======================================================================================

% Figure 7
%\clearpage
%\noindent\includegraphics[width=20pc]{Figure7.eps} \\
%\textbf{Figure 7:} 

%%=======================================================================================

%Figure 8
%\textbf{Figure 8:} \noindent\includegraphics[angle=90,height = 50pc]{Figure8_bw.eps} \\
%\noindent\includegraphics[width= 50pc]{Figure8_bw.eps} \\

%%=========================================================================
% Figure 9
%\noindent\includegraphics[height = 25pc]{Figure9_bw.eps} \\
%\textbf{Figure 9:} 

%%=========================================================================

%Figure 10
%\clearpage
%\noindent\includegraphics[width=20pc]{Figure10_c.eps} \\
%\textbf{Figure 10:} 

%%=========================================================================

% Figure 11
%\clearpage
%\includegraphics{Figure11_bw.eps} \\
%\textbf{Figure 11:} 

%%=========================================================================

% Figure 12
%\clearpage
%\noindent\includegraphics[width = 20pc]{Figure12_c.eps} \\
%\textbf{Figure 12:} 

%%=========================================================================

% Figure 13
%\clearpage
%\includegraphics{Figure13_bw.eps} \\
%\textbf{Figure 13:} 


%\appendix
\clearpage
\begin{centering}
\section*{Appendix}
\end{centering}

\vspace{2em}

\appendix
\subsection*{The Likelihood}
%\numberwithin{equation}{section}
\setcounter{equation}{0}
\renewcommand{\theequation}{A\arabic{equation}}
\setcounter{table}{0}
\renewcommand{\thetable}{A\arabic{table}}


\label{sec-Appendix-noisylikelihood}

The likelihood $P(\widetilde{\delta}_{CWIN}|\widetilde{\delta}_t)$
used in equation (\ref{eq:-bayesian-noisyform}) is given by
\begin{linenomath*} \begin{equation}
\begin{array}{l}
\label{eq-likelihood-int}
P(\widetilde{\delta}_{CWIN}|\widetilde{\delta}_t)  =
A(\widetilde{\delta}_t) C(\bar{\mu}_N, \bar{\sigma}_N)  \\
\hspace{3em} \times \int_0^\infty
B(\widetilde{\delta}_t,\widetilde{\delta}_{CWI})
D(\widetilde{\delta}_{CWI},\bar{\sigma}_N,\bar{\mu}_N )
d\widetilde{\delta}_{CWI}
\end{array}
\end{equation} \end{linenomath*}
where $\widetilde{\delta}_{CWI}$ is an estimate of CWI separation in the absence
of noise,
\begin{linenomath*} \begin{equation}
\label{eq:Adefn}
A(\widetilde{\delta}_t) = \frac{1}{(1-\Phi_{\mu_1,\sigma_1}(0))\sigma_1\sqrt{2\pi} },
\end{equation} \end{linenomath*}
\begin{linenomath*} \begin{equation}
B(\widetilde{\delta}_t,\widetilde{\delta}_{CWI})=e^{  \frac{-(\widetilde{\delta}_{CWI}-\mu_1)^2}{2\sigma_1^2} },
\end{equation} \end{linenomath*}
\begin{linenomath*} \begin{equation}
\label{eq:Cdefn}
C(\bar{\mu}_N, \bar{\sigma}_N) =  \frac{1}{(1-\Phi_{\bar{\mu}_N,\bar{\sigma}_N}(0))\sigma_N\sqrt{2\pi}},
\end{equation} \end{linenomath*}
\begin{linenomath*} \begin{equation}
D(\widetilde{\delta}_{CWI},\bar{\sigma}_N,\bar{\mu}_N )=e^{  \frac{-(\widetilde{\delta}_{CWI}-\bar{\mu}_N)^2}{2 \bar{\sigma}_N ^2} }
\end{equation} \end{linenomath*}
and $\Phi_{\mu,\sigma}(x)$ is the cumulative Gaussian distribution function
\begin{linenomath*} \begin{equation}
\label{eq-cummulative-Gaussian}
\Phi_{\mu,\sigma}(x) = \frac{1}{\sigma \sqrt{2 \pi}}
\int_{-\infty}^x e^{  \frac{-(s-\mu)^2}{2\sigma^2}  } ds
\end{equation} \end{linenomath*}
\citep{dr_Robinson11a}. The parameters $\mu_1$ and $\sigma_1$ used
in equation (\ref{eq:Adefn}) are defined by the expressions
\begin{linenomath*} \begin{equation}
\label{eq:mu1}
\mu_1(\widetilde{\delta}_t) = a_1\frac{a_2 \widetilde{\delta}_t^{a_4}+a_3
\widetilde{\delta}_t^{a_5}}{a_2 \widetilde{\delta}_t^{a_4}+a_3 \widetilde{\delta_t}^{a_5}+1}
\end{equation} \end{linenomath*}
and
\begin{linenomath*} \begin{equation}
\label{eq:sigma1}
\sigma_1(\widetilde{\delta}_t) = c + a_1\frac{a_2 \widetilde{\delta}_t^{a_4}+
a_3 \widetilde{\delta}_t^{a_5}}{a_2 \widetilde{\delta}_t^{a_4}+a_3 \widetilde{\delta}_t^{a_5}+1}
\end{equation} \end{linenomath*}
with coefficients $a_1$ to $a_5$ and $c$ defined in Table
\ref{tab-const4-mu1-sigma1}. The parameters $\bar{\mu}_N$ and
$\bar{\sigma}_N$ used in equation (\ref{eq:Cdefn}) are obtained by
finding the values which minimize the difference in a least squares
sense between the noisy CWI estimates $\widetilde{\delta}_{CWIN}$
computed from the waveforms and the positively bounded Gaussian
density function
\begin{linenomath*} \begin{equation}
\label{eq-likelihood-noisydata-pdf-orig}
\begin{array}{l}
P(\widetilde{\delta}_{CWIN}|\widetilde{\delta}_t,\widetilde{\delta}_{CWI}) \\
\hspace{5em} = \frac{1}{\left(1-\Phi_{\bar{\mu}_N,\bar{\sigma}_N}(0)\right)\bar{\sigma}_N\sqrt{2\pi}}
e^{  \frac{-(\widetilde{\delta}_{CWIN}-\bar{\mu}_N)^2}{2\bar{\sigma}_N^2}  }
\end{array}
\end{equation} \end{linenomath*}
with $\widetilde{\delta}_{CWIN} \geq 0$.

%=======================================================
% Appendix Table

\begin{table}
\caption{Coefficients for equations (\ref{eq:mu1}) and
(\ref{eq:sigma1}).} \label{tab-const4-mu1-sigma1}
\begin{tabular}{|c|c|}
\hline
$\mu_1(\widetilde{\delta}_t)$ & $\sigma_1(\widetilde{\delta}_t)$ \\
\hline
$a1 = 0.4661$ & $a1 = 0.1441$\\
$a2 = 48.9697$ & $a2 = 101.0376$\\
$a3 = 2.4693$ & $a3 = 120.3864$\\
$a4 = 4.2467$ & $a4 = 2.8430$\\
$a5 = 1.1619$ & $a5 = 6.0823$ \\
     & $c = 0.017$ \\
\hline
\end{tabular}
\end{table}

%=======================================================

\vspace{2em}
%\begin{centering}
\subsection*{Derivatives}
%\end{centering}

\label{sec-Appendix-derivatives_ofL}

The derivatives of $L(\mathbf{e}_1,\mathbf{e}_2,...,\mathbf{e}_N)$
\begin{linenomath*} \begin{equation}
\frac{\partial L}{\partial \hat{x}_1},
\frac{\partial L}{\partial \hat{y}_1},
 \frac{\partial L}{\partial \hat{z}_1},
\frac{\partial L}{\partial \hat{x}_2},
\frac{\partial L}{\partial \hat{y}_2},
\frac{\partial L}{\partial \hat{z}_2},
...,
\frac{\partial L}{\partial \hat{x}_N},
\frac{\partial L}{\partial \hat{y}_N},
\frac{\partial L}{\partial \hat{z}_N}
\end{equation} \end{linenomath*}
are required by the Polak-Ribiere algorithm. These are used to guide
the optimization procedure towards the values of
$(\mathbf{e}_1,\mathbf{e}_2,...,\mathbf{e}_N)$ which minimize $L$.

The equations for the derivatives are convoluted so we build them
gradually. We start with an expression for $\delta_t$, the
wavelength normalized separation between two events $\mathbf{e}_p=
(\hat{x}_p,\hat{y}_p,\hat{z}_p)$ and $\mathbf{e}_q =
(\hat{x}_q,\hat{y}_q,\hat{z}_q)$
\begin{linenomath*} \begin{equation}
\label{eq:deltat4chapt6deriv}
\delta_t = \frac{f_{dom}}{v_s}\sqrt{(\hat{x}_p-\hat{x}_q)^2 + (\hat{y}_p-\hat{y}_q)^2 +  (\hat{z}_p-\hat{z}_q)^2},
\end{equation} \end{linenomath*}
where $f_{dom}$ is the dominant frequency of the waveforms and $v_s$ is the velocity between the events. Expression
\ref{eq:deltat4chapt6deriv} has derivatives
\begin{linenomath*} \begin{equation}
\label{eq-partial-xyz1}
\begin{array}{l}
\frac{\partial \widetilde{\delta}_t}{\partial \hat{x}_p} = \frac{f_{dom}^2 (\hat{x}_p-\hat{x}_q)}{v_s^2 \widetilde{\delta}_t},
\frac{\partial \widetilde{\delta}_t}{\partial \hat{y}_p} = \frac{f_{dom}^2 (\hat{y}_p-\hat{y}_q)}{v_s^2 \widetilde{\delta}_t}, \\
\frac{\partial \widetilde{\delta}_t}{\partial \hat{z}_p} = \frac{f_{dom}^2 (\hat{z}_p-\hat{z}_q)}{v_s^2 \widetilde{\delta}_t},
\frac{\partial \widetilde{\delta}_t}{\partial \hat{x}_q} = \frac{f_{dom}^2 (\hat{x}_q-\hat{x}_p)}{v_s^2 \widetilde{\delta}_t}, \\
\frac{\partial \widetilde{\delta}_t}{\partial \hat{y}_q} = \frac{f_{dom}^2 (\hat{y}_q-\hat{y}_p)}{v_s^2 \widetilde{\delta}_t},
\frac{\partial \widetilde{\delta}_t}{\partial \hat{z}_q} = \frac{f_{dom}^2 (\hat{z}_q-\hat{z}_p)}{v_s^2 \widetilde{\delta}_t}.
\end{array}
\end{equation} \end{linenomath*}
For brevity we focus the following derivation in terms of $\hat{x}_p$. The remaining terms for $\mathbf{e}_p$
(i.e. $\hat{y}_p$ and $\hat{z}_p$) can be computed
by following the same procedure. The derivatives for $\mathbf{e}_q$ can be attained by exploiting the symmetry
\begin{linenomath*} \begin{equation}
\label{eq:ep2eq-deriv-symmetry}
\frac{\partial \widetilde{\delta}_t}{\partial \hat{x}_q} = - \frac{\partial \widetilde{\delta}_t}{\partial \hat{x}_p}.
\end{equation} \end{linenomath*}

The chain rule gives
\begin{linenomath*} \begin{equation}
\frac{\partial \mu_1}{\partial \hat{x}_p} = \frac{\partial \mu_1}{\partial \widetilde{\delta}_t} \frac{\partial \widetilde{\delta}_t}{\partial \hat{x}_p}
\end{equation} \end{linenomath*}
where differentiating equation (\ref{eq:mu1}) gives
\begin{linenomath*} \begin{equation}
\label{eq-dmu1-by-dx1}
\frac{\partial \mu_1}{\partial \widetilde{\delta}_t} = a_1 \frac{a_2 a_4 \widetilde{\delta}_t^{a_4-1} +a_3 a_5 \widetilde{\delta}_t^{a_5-1}}
{\left(a_2 \widetilde{\delta}_t^{a_4} +a_3 \widetilde{\delta}_t^{a_5} +1 \right)^2}.
\end{equation} \end{linenomath*}
Similarly, we have
\begin{linenomath*} \begin{equation}
\frac{\partial \sigma_1}{\partial \hat{x}_p} = \frac{\partial \sigma_1}{\partial \widetilde{\delta}_t} \frac{\partial \widetilde{\delta}_t}
{\partial \hat{x}_p}
\end{equation} \end{linenomath*}
where $\frac{\partial \sigma_1}{\partial \widetilde{\delta}_t}$ has the identical form as \ref{eq-dmu1-by-dx1} with different constants
$a_1,a_2,...,a_5$ (see table \ref{tab-const4-mu1-sigma1}).

The cumulative Gaussian distribution function \ref{eq-cummulative-Gaussian} is
\begin{linenomath*} \begin{equation}
\Phi_{\mu_1,\sigma_1}(0) = \frac{1}{\sigma_1 \sqrt{2 \pi}}
\int_{-\infty}^0 e^{  \frac{-(s-\mu_1)^2}{2\sigma_1^2}  } ds
\end{equation} \end{linenomath*}
which has derivative
\begin{linenomath*} \begin{equation}
\frac{\partial \Phi_{\mu_1,\sigma_1}(0)}{\partial \hat{x}_p} =
\frac{ \sigma_1 \int_{-\infty}^0 \frac{\partial g}{\partial \hat{x}_p} e^g ds -
\frac{\partial \sigma_1}{\partial \hat{x}_p} \int_{-\infty}^0 e^g ds}
{\sigma_1^2 \sqrt{2 \pi}},
\end{equation} \end{linenomath*}
where
\begin{linenomath*} \begin{equation}
g = \frac{-(s-\mu_1)^2}{2 \sigma_1^2}
\end{equation} \end{linenomath*}
and
\begin{linenomath*} \begin{equation}
\frac{\partial g}{\partial \hat{x}_p} = \frac{4 \sigma_1^2 (s-\mu_1) \frac{\partial \mu_1}{\partial \hat{x}_p}
+ 4\sigma_1 \frac{\partial \sigma_1}{\partial \hat{x}_p}(s-\mu_1)^2}
{4 \sigma_1^4}.
\end{equation} \end{linenomath*}

Now, we have all the pieces to compute the derivatives of $A=A(\delta_t)$ and $B = B(\delta_t,\delta_{CWI})$ as follows
\begin{linenomath*} \begin{equation}
\frac{\partial A} {\partial \hat{x}_p} =
-\frac{ -\frac{\partial  \Phi_{\mu_1,\sigma_1}(0)}{\partial \hat{x}_p} \sigma_1 +
 \left(1- \Phi_{\mu_1,\sigma_1}(0) \right) \frac{\partial \sigma_1}{\partial \hat{x}_p}}
{\left(1- \Phi_{\mu_1,\sigma_1}(0) \right)^2 \sigma_1^2 \sqrt{2 \pi}}
\end{equation} \end{linenomath*}
and
\begin{linenomath*} \begin{equation}
\frac{\partial B} {\partial \hat{x}_p} = e^h \frac{\partial h}{\partial \hat{x}_p},
\end{equation} \end{linenomath*}
where
\begin{linenomath*} \begin{equation}
h =  \frac{-(\delta_{CWI}-\mu_1)^2}{2 \sigma_1^2}
\end{equation} \end{linenomath*}
and
\begin{linenomath*} \begin{equation}
\frac{\partial h}{\partial \hat{x}_p} = \frac{
4 \sigma_1^2 (\delta_{CWI}-\mu_1) \frac{\partial \mu_1}{\partial \hat{x}_p}
+ 4(\delta_{CWI}-\mu_1)^2 \sigma_1 \frac{\partial \sigma_1}{\partial \hat{x}_p} }
{4 \sigma_1^4}.
\end{equation} \end{linenomath*}
Finally, we can differentiate the likelihood for an individual event pair
\begin{linenomath*} \begin{equation}
\begin{array}{l}
\frac{\partial P(\delta_{CWIN}|\widetilde{\delta}_t)} {\partial \hat{x}_p}  =
\frac{\partial A(\widetilde{\delta}_t)}{\partial \hat{x}_p} C(\bar{\mu}_N, \bar{\sigma}_N) \\
\hspace{2em} \times \int_0^\infty B(\widetilde{\delta}_t,\widetilde{\delta}_{CWI})
D(\widetilde{\delta}_{CWI},\bar{\sigma}_N,\bar{\mu}_N )
d\widetilde{\delta}_{CWI} \\
\hspace{2em} + A(\widetilde{\delta}_t) C(\bar{\mu}_N, \bar{\sigma}_N) \\
\hspace{2em} \times \int_0^\infty
\frac{\partial B(\widetilde{\delta}_t,\widetilde{\delta}_{CWI})} {\partial \hat{x}_p}
D(\widetilde{\delta}_{CWI},\bar{\sigma}_N,\bar{\mu}_N )
d\widetilde{\delta}_{CWI}
\end{array}
\end{equation} \end{linenomath*}
and for the logarithm we have
\begin{linenomath*} \begin{equation}
\frac{ \partial \ln \left[ P(\delta_{CWIN}|\delta_t) \right] } {\partial \hat{x}_p}
= \frac{1}{P(\delta_{CWIN}|\delta_t)} \frac{\partial P(\delta_{CWIN}|\delta_t)}{\partial \hat{x}_p}.
\end{equation} \end{linenomath*}


Thus, it follows that the derivative of $L$ with respect to $\hat{x}_p$ is given by
%\begin{linenomath*} \begin{equation}
%\label{eq-derivative-Lstar-cwionly22}
%\frac{\partial L(E_1, E_2, ..., E_n)}{\partial \hat{x}_p} =
%- \sum_{i=p+1}^{N} \frac{ \partial \ln \left[P(\delta_{CWIN}|E_p,E_i)\right]}{\partial \hat{x}_p}
%+ \sum_{j=1}^{p-1} \frac{ \partial \ln \left[P(\delta_{CWIN}|E_j,E_p)\right]}{\partial \hat{x}_p}
%\end{equation} \end{linenomath*}
\begin{linenomath*} \begin{equation}   
\label{eq-derivative-Lstar-cwionly}
\begin{array}{ll}
\frac{\partial L(E_1, E_2, ..., E_n)}{\partial \hat{x}_p} = &
- \sum_{i=p+1}^{N} \frac{ \partial \ln \left[P(\delta_{CWIN}|E_p,E_i)\right]}{\partial \hat{x}_p} \\
 & + \sum_{j=1}^{p-1} \frac{ \partial \ln \left[P(\delta_{CWIN}|E_j,E_p)\right]}{\partial \hat{x}_p}
\end{array}
\end{equation} \end{linenomath*}
%
%\iftwocol{\begin{eqnarray} \frac{\partial L(E_1, E_2, ..., E_n)}{\partial \hat{x}_p} &  = &\\
%- \sum_{i=p+1}^{N} \frac{ \partial \ln \left[P(\delta_{CWIN}|E_p,E_i)\right]}{\partial \hat{x}_p} \\
%+ \sum_{j=1}^{p-1} \frac{ \partial \ln \left[P(\delta_{CWIN}|E_j,E_p)\right]}{\partial \hat{x}_p}
%\end{eqnarray}}
%{\frac{\partial L(E_1, E_2, ..., E_n)}{\partial \hat{x}_p} =
%- \sum_{i=p+1}^{N} \frac{ \partial \ln \left[P(\delta_{CWIN}|E_p,E_i)\right]}{\partial \hat{x}_p}
%+ \sum_{j=1}^{p-1} \frac{ \partial \ln \left[P(\delta_{CWIN}|E_j,E_p)\right]}{\partial \hat{x}_p}}
%\end{equation} \end{linenomath*} 
for a uniform prior. The change of sign in the middle (i.e. to
addition) accounts for the change in order of the events under the
conditional. Its inclusion here assumes the correct use of $\partial
\widetilde{\delta}_t / \partial \hat{x}_p$ or $\partial
\widetilde{\delta}_t / \partial \hat{x}_q$ when evaluating the left
and right hand terms of the summation. The derivatives shown in this
section appear complicated but are in practice trivial to compute
numerically. Confidence in their accuracy is enhanced by
demonstrating that the optimization procedure converges to the
correct solution for a number of synthetic problems in 2 and 3
dimensions.


\clearpage








%\bsp % ``This paper has been produced using the Blackwell
     %   Publishing GJI \LaTeXe\ class file.''

\label{lastpage}


\end{document}
